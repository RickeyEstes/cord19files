The structure of our framework can be summarised in the following five steps. A full description of each step is provided in the next section. (i) In the first step, the history of lineage dispersal is recovered from one or more spatial-and temporallyreferenced phylogenies (i.e. trees whose branches represent time and whose tips and internal nodes all have a defined location). Such trees are generated by the continuous phylogeography method implemented in BEAST [15] , but it is important to note that our method is applicable phylogenies from any source that are annotated with dates and locations in the same way (Fig. 1a) . The velocity, distance and duration of spatial movement along each branch in each tree are extracted and represented by a vector. (ii) In a second, optional, step, the spatio-temporal data extracted in step (i) is used to calculate summary statistics of spatial spread, such as the velocity of the epidemic wavefront. (iii)Each of the vectors obtained in step (i) is assigned a "weight" score, which is calculated using a raster that defines the spatial heterogeneity of a specified environmental variable (e.g. elevation, human population density, land cover, etc.). We have implemented three different models of spatial movement (hereafter called "path models") to compute the "weight" allocated to each phylogeny branch for a given environmental raster. (a) The "straight-line path" model, which assumes that movement is in a straight-line between the start and end locations of each branch. (b) The "least-cost path" model, which uses a least-cost algorithm [26] to determine the route taken between the start and end points. (c) The "random walk path" model, which uses circuit theory [27] to accommodate uncertainty in the route taken. Note that for models (b) and (c), each environmental raster must be considered twice, once as a conductance factor (i.e. it facilitates movement) and once as a resistance factor (i.e. it impedes movement). (iv) The correlation between the duration of each phylogeny branch and its "weight" (see step iii) is then estimated. Correlations are repeated for each environmental raster, and for each of the three path models described above. (v) Finally, the statistical significance of these correlations is tested using a null model. To generate this null model, we implement a simple randomisation procedure: phylogenetic node positions are randomised within the study area, under the constraint that branch lengths, tree topology and root position are unchanged (see Fig. 1b ). Step 1: Extracting spatio-temporal information from phylogenies The input data for our method consists of one or more spatiotemporally-referenced phylogenies (i.e. trees whose branch lengths are proportional to time and whose internal and external nodes are all annotated with a point location in two-dimensional space; Fig. 1a ). If multiple phylogenies are used then each is assumed to be equally probable. At present, such trees are mostly likely to be generated using the phylogeographic models implemented in BEAST [15] , but our framework can be applied to phylogenies from any source that have been annotated in the same way. In order to extract the spatio-temporal information in the input trees, each phylogeny branch in each tree is summarised as a vector defined by its start and end location, and its start and end dates. Each branch therefore represents an independent viral lineage dispersal event [18] . Vectors for each input tree are tabulated. Step 2: Estimation of dispersal and epidemiological statistics As an optional step, our analytical framework calculates several spatio-temporal statistics from these dispersal vectors. So far, we have implemented three such statistics: the mean lineage dispersal velocity, the mean lineage diffusion coefficient, and a time-series of the maximal epidemic wavefront distance. These statistics are visually summarised as plots of (i) the kernel density of lineage dispersal velocity parameters (the mean and variation among lineages in dispersal velocity), (ii) the kernel density of lineage diffusion coefficient parameters (the mean and variation among lineages in diffusion coefficients), and (iii) the change through time in the spatial and patristic maximal wavefront distances, as measured from the location of the tree root. The spatial distance corresponds to a straight-line distance, whereas the patristic distance equals the sum of the spatial distances along each phylogeny branch between the tree root and its tips. Step 3: Computation of environmental weights In this step, each of the vectors obtained in step 1 (one per phylogeny branch) is assigned a specific "weight" based on a raster of values that represent the type or magnitude of an environmental variable (e.g. elevation, population density, type of land cover). In order to compute these "weights", we have implemented three different "path models" which represent the path taken by a phylogeny branch as it travels between its start and end locations: (i) Straight-line path: each lineage travels in a straight line between its start and end location. In this case, the branch "weight" is computed as the sum of the values of the raster cells through which the straight line passes. (ii) Least-cost path: each lineage travels via the leastcost path between its start and end location [26] . With this model, the branch "weight" is computed as the sum of the transition values between adjacent cells along the least-cost path [28] . (iii)Random walk path: each lineage travels via a random walk between its start and end location. In this case, the "weight" is a graph-theoretic metric based on circuit theory, which takes into account multiple possible pathways connecting a given pair of locations, and the values of the raster cells through which they pass [27, 29] . Specifically, for each lineage, one node is connected to a one-ampere current source, while the other is connected to ground. The "weight" between each pair of nodes is then defined by the effective electric resistance or conductance connecting them on the grid, i.e. the environmental raster in question [27] . More details about the circuit theory model can be found in [27] and [29] . For the latter two models, an environmental variable can be treated either as a conductance or a resistance factor. For example, if an environmental raster is treated as a resistance factor then raster cells with low values will be more permeable to dispersal and those with high values will correspond to poor dispersal habitat or to movement barriers [27] . When there is no prior information about whether a given variable will facilitate or impede lineage movement, it is prudent to consider it twice, once as a potential conductance factor, and once as a potential resistance factor. By default, we use the environmental values as resistance or conductance values. Log-transformed and/or standardised values may be necessary if the current univariate approach is in future extended to a multivariate one (see Conclusion). Note, when all cells in a raster are identically-valued (i.e. there is no spatial variation in the environmental factor) then the total "weight" for any path is simply proportional to its geographic distance. A special case exists when all cells have values equal to 1, which we here define as the "null raster". 


Section:overview of methodology
Section:description of methodology