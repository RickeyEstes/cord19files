We now employ quantitative models to evaluate the intuitive ideas presented above. Given the high dimensionality of the problem, we are especially interested in how well intuition works and whether generalities are observed across large regions of parameter space. A flow diagram of the elements and interactions within the host reveals the complexity of the model (Fig 3) and facilitates understanding the dynamical equations. V and W are the respective vaccine and revertant densities, with intrinsic growth and death rates governed by four parameters (not illustrated). The model also includes variables for resources (R), innate immunity (Z), adaptive immunity to vector (Y), and adaptive immunity to antigen (X) that are both influenced by and influence V and W. In the following sections, we explore the dynamics of these interactions with simulations and present results graphically (the results presented do not allow resource limitation to influence dynamics; trials where resource limitation matters were conducted but are not shown). Equations and parameter values are provided in S1 Appendix. Resource limitation and innate immunity yield qualitatively similar results, so trials with resource limitation are not illustrated in the main text. The equations apply only to within-host processes; any pre-host evolution is subsumed into inoculum composition. The models assist us by forcing us to specify assumptions for how the viruses and immunity interact, and by allowing us to rigorously explore outcomes in different scenarios. However, there is uncertainty in the model structure, many parameter values are unknown, and different viruses will behave somewhat differently. Consequently, we focus on broad generalities that arise from many simulations and illustrate these for a few specific cases, reserving Supporting Information files for further details. The presentation below briefly discusses the dynamics of individual trials for illustration but then moves to contour plots that reveal differences in outcomes as the key parameters are changed. The model used here incorporates the structure of earlier models that described immune responses [36] [37] [38] ; parameter values used here were chosen as described in some of these earlier studies. Evolution can matter. In the trials used for illustration, we allow innate immunity to control the infection and adaptive immunity to cause final clearance. Such a scenario might correspond to the dynamics of Listeria or influenza infections of mice [32] , or the early dynamics of SIV infections [39] . To get a sense of the full dynamics in the model, we show the time course of dynamics for the different variables (Fig 4) under conditions of no evolution (top left), just pre-host evolution-revertant abundant in the inoculum but with no fitness advantage (top right), mostly within-host evolution (bottom left), and both (bottom right). The effect of different types of evolution is seen from a comparison of the panels. Our chief interest is in final immunity to vaccine, the blue curves. The most visible effect of evolution on immunity to the antigen is evident in the lower right panel, which combines pre-host evolution with a fitness advantage of the revertant. However, the log scale diminishes the visual impact of substantial evolution in other cases. When the revertant is half the inoculum but has no fitness advantage, the immune response is diminished by nearly 3-fold (top right). Overall, the impression is that one must at least suppress either pre-host or within-host evolution to avoid a large loss in immunity (lower right versus the others). Illustrations of dynamics from individual trials convey many details. However, without a specific empirical basis for the parameter values chosen, the details have little assured relevance. We therefore provide contour plots that allow easy comparison of many different trials in which parameters of specific interest are varied (Fig 5) . These graphs show the cumulative vaccine load (left panel) and final level of immunity to vaccine antigen (right) as a function of initial revertant frequencies and selective advantage of the revertant (c). A strong correspondence exists between vaccine load and the level of immunity generated, as is observed empirically following infection [40] . Subsequent figures therefore illustrate the level of immunity. The initial composition of the inoculum matters somewhat more to the adaptive response than does the intrinsic cost of the vaccine (as evident by the contours being closer to vertical rather than horizontal), but this pattern rests heavily on the parameter ranges chosen. Indeed, unrealistically large values of initial revertant levels (W(0)) are illustrated to offer contrast, as the outcomes are otherwise moderately insensitive to vaccine composition in these graphs. The good news is that, when the inoculum is mostly vaccine and revertant fitness is not high, evolution has little effect on viral load or final level of immunity (i.e., the lower left of each panel has a broad area of one color). This occurs because of the short duration of infection. Over longer periods of vaccine growth, the selective advantage of the revertant would undoubtedly play an increasing role in evolution. The large number of parameters (13) limits the degree to which we can conduct comprehensive sensitivity tests, so the trials are confined to variations in those parameters of greatest interest. Vaccine evolution driven by adaptive immunity. We focus on infections of short duration-that are cleared and do not rebound once suppressed. Factors that limit the duration of infection include resource limitation, and innate and adaptive immunity. For the most part these factors act equally against vaccine and revertant virus. Only one factor, adaptive immunity to the vaccine antigen (X), acts specifically on the vaccine virus and not the revertant. Intuition suggests that this adaptive immunity to the antigen can potentially suppress the vaccine's growth and give an advantage to the revertant. As with intrinsic fitness costs, this selection might feed back to limit vaccine growth and thus limit the development of further immunity to antigen by allowing revertant to grow and interfere with vaccine. This section considers whether these arguments are supported by the model. Any real vaccine that elicits immunity against the antigen may also experience an intrinsic fitness cost. The effect of immunity on evolution would then be confounded with the effect of intrinsic fitness effects on evolution, making it difficult to isolate one from the other. The models do not face this problem, however. They can be parameterized so that the only possible selection against the vaccine comes from immunity (by setting c = 0). Vaccine populations can also be freed of revertant by omitting revertant from the inoculum and setting the mutation rate to 0. Thus, we can measure the effect of adaptive immunity on vaccine growth from trials that lack revertant and then compare those results with trials that include revertant. The revertant is included at half the inoculum (representing pre-host evolution); it has no intrinsic fitness advantage over vaccine. Immunity (to vaccine) is reduced to just over a third of the level with no evolution. (Lower left): The revertant is a small fraction of the inoculum (0.01) but it has a 20% fitness advantage over vaccine. The level of immunity is 71% that with no evolution. (Lower right): The revertant is half the inoculum and has a 20% fitness advantage over vaccine. The level of immunity is now less than 0.3% that with no evolution-a depression of almost 3 orders of magnitude. The trials are parameterized so that virus is controlled by innate immunity with final clearance due to adaptive immunity; the mutation rate is 0 in all cases. Equations, initial conditions and parameter values not shown here are given in S1 Appendix; R code is included in S1 File. There are several background points to note about the model structure. First, adaptive immunity specific to vaccine (X) develops at a rate proportional to the vaccine abundance (V) and parameters s (rate of clonal expansion of adaptive immunity) and ϕ X (antigen concentration yielding half the maximum growth rate of adaptive immunity X). In contrast, the impairment specific to vaccine is due to the level of immunity (X) and the vaccine impairment parameter k X . Thus, immunity can develop while imposing little or no impairment, i.e., when k X ! 0. Second, adaptive immunity to the vector (Y) develops according to its own growth rate parameter (ϕ Y ) in response to vaccine plus revertant abundance (V + W), and it impairs both vaccine and revertant growth equally by impairment parameter k Y . When revertant is present, it increases the level of immunity to vector backbone/revertant but does not directly affect immunity specific to the vaccine. This immunity will result in faster clearance of both revertant and vaccine, and this results in decreased immunity to the antigen; this is the 'interference' that causes a problem from vaccine evolution. Trials were run that contrasted revertant absence versus revertant introduced at 75% of the inoculum-no evolution versus primairly pre-host evolution, respectively (Fig 6) . Absence of the revertant is the baseline against which the effect of evolution can be compared. The horizontal axis varies k X , the parameter for impairment/killing specific to vaccine, and the vertical axis varies k Y , impairment to vector, which affects vaccine and revertant equally. In both panels, increasing impairment against vaccine leads to lower levels of immunity to the vaccinethis is the self-limiting effect of adaptive immunity, which exists even in the absence of evolution. As expected, impairment of immunity to vaccine by immunity to vector is also found. A large effect of inoculum composition on vaccine immunogenicity is evident by comparing the left panel (no mutation, no evolution) and right panel (chiefly prehost evolution): introduction of revertant reduces the level of immunity against vaccine up to 10-fold. For the -host evolution) . The final vaccine load and immunity against the vaccine antigen depends heavily on two parameters, the inoculum composition (plotted on the x-axis as initial abundance of the revertant virus, W(0)) and the growth advantage of the revertant within the host (c, plotted on the y-axis). The heat maps show how, as the composition shifts toward revertant or as vector superiority increases (as we move to the right or up), there is a reduction in the viral load of the vaccine (defined as R V dt, left panel) and in the magnitude of immunity to the vaccine antigen (X, right panel). The initial amount of vaccine virus is always V(0) = 1 (i.e. logV(0) = 0). Note that the graphs span high frequencies of revertant in the inoculum that should be easily avoided (log W(0) = 1, i.e. W(0) = 10 V(0))-if the researcher is alert to the possibility. We include such extremes merely to show that the outcome is relatively insensitive to small changes in vaccine composition. Equations, initial conditions and parameter values not shown here are given in S1 Appendix; R code is included in S1 File. https://doi.org/10.1371/journal.pcbi.1006857.g005 Within-host vaccine evolution right panel, the revertant is 3/4 the inoculum and has no intrinsic advantage over vaccine; total inoculum size is unchanged. All reduction of immunity against vaccine is thus due to revertant in the inoculum and any within-host evolution from the selective effect that stems from immunity against vaccine. Of the two parameters, k Y has a much larger effect than does k X : compared to the left panel, the right panel, with revertant present, has vaccine-specific immunity suppressed more than an order of magnitude along the k Y axis, much less so on the k X axis. We attribute this effect of k Y to interference by the revertant: the revertant elicits high levels of immunity (Y) that indiscriminately also suppress vaccine, thereby suppressing vaccine-specific immunity X. The magnitude of interference depends not only on revertant abundance but also on the values of k X , k Y , and the innate immune response (k Z ), so interference can appear more or less important in other trials using the same revertant abundance. A question motivating this analysis was one step deeper in the complexity of these effects: does the self-limiting effect of adaptive immunity worsen when revertant is present? This question can be answered by comparing the self-inhibitory effect between left and right panels as k X is increased. By inspection of colors along the horizontal axes, it is seen that the self-inhibitory effect is actually somewhat reduced by the revertant. The revertant lowers the overall response to vaccine, but when correcting for that difference, the effect of increasing k X is slightly weaker in the right panel than in the left. We attribute this weakening of self-limitation as due to vaccine levels being increasingly controlled by immunity against revertant. In sum, therefore, immunity to the vaccine (X) is reduced by itself (depending on the immunity parameter, k X ) and by revertant. The two effects do not interact to make the problem worse than from their separate effects. 


Section:beyond intuition: a formal model and numerical results