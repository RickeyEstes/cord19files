We compare inference within our study (summarised in Figure 5b) to previous results at a series of well-studied epitopes. Putative CTL escape sites within HLA-B associated A-list epitopes are highlighted in yellow. Notice that many A-list epitopes are not variable. B * 07 epitope SPAIFQSSM (sites 156-164 in reverse transcriptase). We detect strong B * 07-dependent selection at the known escape site (position 162) [34, 35] . We also find two more top-tier sites and several second-tier sites within the epitope. On further investigation of the literature we find that many variants exist for this epitope, which result in non-susceptible forms in some individuals and susceptible forms in others [36] . B * 18 epitope NETPGIRYQY (sites 137-146 in reverse transcriptase). We detect strong B * 18-dependent selection at the first anchor residue of NETPGIRYQY (site 138) [35, 37] . We do not detect selection at the other escape site. Further investigation of the literature reveals that the 'diminished response' induced by a variant at this site is actually recognised to much the same levels as the wild type epitope, and precedes outgrowth of the single variant at the first anchor residue in the single patient studied [38] . Moving on to protease in Supplementary Figure 15 , we detect a strong signal of selection within the B * 44 epitope EEMNLPGRW. This signal is particularly strong at the first anchor residue (site 35) where escape is known to occur [39, 40] . We now consider well-studied HLA-A epitopes, again starting with reverse transcriptase. See Supplementary Figures 17 (note there are no HLA-C epitopes in our well-studied list): A * 02 epitope YTAFTIPSV (sites 127-135 in reverse transcriptase). We do not detect A * 02-associated selection in YTAFTIPSV. The subtype B and C consensus residue at the escape site (position 135) is the defined escape allele [41] , explaining why we do not detect a signal. However, we notice that a signal at the escape site is picked up when considering subtype B viruses (see the fifth and sixth A * 02 strips of Supplementary Figure 17 ). This suggests that other mutations at the same residue can also result in a diminished CTL response. A * 03 epitope AIFQSSMTK (sites 158-166 in reverse transcriptase). Escape is known to occur at the second anchor residue (site 166) [42, 43] . This site is in our collection of second tier candidates, see Supplementary Figure 17 , with much of the signal coming from the subtype C viruses. However, we do not detect any A * 03-associated selection elsewhere in the epitope. A * 11 epitope AIFQSSMTK (sites 158-166 in reverse transcriptase). We do not detect A * 11 dependent selection in this epitope. A * 11 is a relatively rare HLA allele in our query data set. A * 02 epitope LVGPTPVNI (sites 76-84 in protease). Finally, looking at Supplementary Figure 14 we see that A * 02-dependent selection is detected in LVGPTPVNI, but not at the reported escape site. We detect strong selection at the first anchor residue, and slightly upstream of the epitope. Interestingly, some literature suggests that the wild type sequence is not recognised, and a drug induced mutation at the escape site (position 82) results in epitope recognition [44] . These conflicting signals may explain why we do not detect A * 02-associated selection at the known escape site. These findings demonstrate the ability of our method to accurately identify many sites known to be under HLA associated selection, and highlight the nuanced effects of many putative escape variants. N (0, 4) . µ was set at 40, and κ was set at 7.60. The recombination probability between sites, r i , was set at a constant across the region, which we varied between collections of runs (r ∈ {0, 0.01, 0.05}). Figure 5 : Simulation Study 1: comparison of estimates obtained using the closest 100 sequences by Hamming distance to the sequences actually copied from in the simulation, r = 0.05. Averages are taken over 100 independent MCMC runs on independent simulated data with the same underlying parameters. Plotting for the first three rows is as in Figure 3 . The first row shows inference results for HLA 3 associated selection and reversion using sequences copied from in the restriction of D B , the second row shows the corresponding inference results when restricting D B is restricted using the closest 100 sequences by Hamming distance. The third row displays the coverage using the different restrictions. The final two rows display recombination estimates, and an example of inference of ω across the region for the restriction using the sequences copied from and the closest 100 by Hamming distance respectively. Source data are provided as a Source Data file. 1) . For Fryer Approx this is because we stop our threshold for estimated rates at 0. For PhyloD and PhyloD OR, it is because many sites will not be included in leaf distribution or logistic regression respectively. Source data are provided as a Source Data file. (1, 1) . For Fryer Approx this is because we stop our threshold for estimated rates at 0. For PhyloD and PhyloD OR, it is because many sites will not be included in leaf distribution or logistic regression respectively. Pink to red lines and dashed lines show the ROC curves for our approach, using different D B . From light to dark, we sampled 100%, 10% and 1% of D B from each independent run in Simulation Study 2 and estimated HLA-associated selection. Dashed lines of the same colour also include D in D B using a leave one out approach. The black ROC curve shows the results of considering only D using a leave one out approach. Source data are provided as a Source Data file. Grey and white bands display the 5% -95% and 25% -75% credible intervals. In the third row, we display the coverage for the 95% and 50% credible intervals in blue and black respectively. The solid lines are using the gold standard reference set, and the dotted lines are using reference data from all public databases. In each of the fourth rows we display the average RMSE at each site for different D B as defined in the key. Source data are provided as a Source Data file. Grey and white bands display the 5% -95% and 25% -75% credible intervals. In the third row, we display the coverage for the 95% and 50% credible intervals in blue and black respectively. The solid lines are using the gold standard reference set, and the dotted lines are using reference data from all public databases. In each of the fourth rows we display the average RMSE at each site for different D B as defined in the key. Source data are provided as a Source Data file. Grey and white bands display the 5% -95% and 25% -75% credible intervals. In the third row, we display the coverage for the 95% and 50% credible intervals in blue and black respectively. The solid lines are using the gold standard reference set, and the dotted lines are using reference data from all public databases. In each of the fourth rows we display the average RMSE at each site for different D B as defined in the key. Source data are provided as a Source Data file. We display a summary of all the results of each of our MCMC runs applied to protease. Inference results on the grey horizontal strips are coloured as shown in the key. Two grey strips per HLA show selection away from C = B and C = C respectively. Bar plots to the right show HLA frequencies. The two lowest strips summarise median ω according to the colour bar. Blue vertical lines denote drug resistance sites. Green vertical lines denote sites at which there is an amino acid difference between the subtype B and subtype C consensus viral sequence. Colouring of epitopes plotted above the grey lines refers to the A-list [45] and B-list [46] which are coloured purple and pink respectively. In addition, we colour sites of known escape variants within the A-list epitopes in yellow. Figure 15 : Summary of HLA-B associated selection in protease. We display a summary of all the results of each of our MCMC runs applied to protease. Inference results on the grey horizontal strips are coloured as shown in the key. Two grey strips per HLA show selection away from C = B and C = C respectively. Bar plots to the right show HLA frequencies. The two lowest strips summarise median ω according to the colour bar. Blue vertical lines denote drug resistance sites. Green vertical lines denote sites at which there is an amino acid difference between the subtype B and subtype C consensus viral sequence. Colouring of epitopes plotted above the grey lines refers to the A-list [45] and B-list [46] which are coloured purple and pink respectively. In addition, we colour sites of known escape variants within the A-list epitopes in yellow. Source data are provided as a Source Data file. Figure 16 : Summary of HLA-C associated selection in protease. We display a summary of all the results of each of our MCMC runs applied to protease. Inference results on the grey horizontal strips are coloured as shown in the key. Two grey strips per HLA show selection away from C = B and C = C respectively. Bar plots to the right show HLA frequencies. The two lowest strips summarise median ω according to the colour bar. Blue vertical lines denote drug resistance sites. Green vertical lines denote sites at which there is an amino acid difference between the subtype B and subtype C consensus viral sequence. Colouring of epitopes plotted above the grey lines refers to the A-list [45] and B-list [46] which are coloured purple and pink respectively. In addition, we colour sites of known escape variants within the A-list epitopes in yellow. Source data are provided as a Source Data file. Figure 17 : Summary of HLA-A associated selection in reverse transcriptase. We display a summary of all the results of each of our MCMC runs applied to protease. Inference results on the grey horizontal strips are coloured as shown in the key. Two grey strips per HLA show selection away from C = B and C = C respectively. Bar plots to the right show HLA frequencies. The two lowest strips summarise median ω according to the colour bar. Blue vertical lines denote drug resistance sites. Green vertical lines denote sites at which there is an amino acid difference between the subtype B and subtype C consensus viral sequence. Colouring of epitopes plotted above the grey lines refers to the A-list [45] and B-list [46] which are coloured purple and pink respectively. In addition, we colour sites of known escape variants within the A-list epitopes in yellow. Source data are provided as a Source Data file. Figure 18 : Summary of HLA-C associated selection in reverse transcriptase. We display a summary of all the results of each of our MCMC runs applied to protease. Inference results on the grey horizontal strips are coloured as shown in the key. Two grey strips per HLA show selection away from C = B and C = C respectively. Bar plots to the right show HLA frequencies. The two lowest strips summarise median ω according to the colour bar. Blue vertical lines denote drug resistance sites. Green vertical lines denote sites at which there is an amino acid difference between the subtype B and subtype C consensus viral sequence. Colouring of epitopes plotted above the grey lines refers to the A-list [45] and B-list [46] which are coloured purple and pink respectively. In addition, we colour sites of known escape variants within the A-list epitopes in yellow. Source data are provided as a Source Data file. Figure 19 : Estimated recombination probabilities between sites across protease and reverse transcriptase. The mean estimate is plotted in black, the median is plotted in red. The white band denotes the 50% credible interval within the 95% credible interval denoted by the grey band. Blue vertical lines denote drug resistance sites. Green vertical lines denote sites at which there is an amino acid difference between the subtype B and subtype C consensus viral sequence. Source data are provided as a Source Data file. The impact of HLA alleles on differentiation between HIV-1 subtypes. Let C B and C B be the subtype B and subtype C viral sequence consensus respectively. Let H B and H C be the distribution of HLA types in individuals harbouring subtype B and subtype C viruses as defined by RIP [47] in the query data set. The panels display comparisons of HLA-associated selection pressure away from C B and C C by H B and H C . The first row shows results for protease, and the second row shows results for reverse transcriptase. Sites that distinguish subtype B and subtype C at the amino acid level are highlighted in red. Source data are provided as a Source Data file. 


Section:comparison of results at well-studied epitopes