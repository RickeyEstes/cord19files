Imino Proton Distances in PDB Helices. Adjacent canonical base pairs and therefore potential helices can be identified from NOEs between imino protons separated by <5 Å. A database of imino proton distances between doublets of canonical base pairs was assembled from 3D structures in the Protein Data Bank (PDB). 57 Distances were obtained from nonredundant X-ray structures with a resolution no larger than 2 Å, 58 to which hydrogens were added with the REDUCE program 59 and then averaged for each doublet of canonical pairs. For doublets with at least one GU pair, G/G, G/U, and/ or U/U, imino proton distances between adjacent base pairs were averaged separately, although the 5′G-5′U and 3′G-3′U distances were averaged together for 5′GG3′/3′UU5′. A separate set of imino proton distances for each doublet was obtained from NMR structures. Imino distances between doublets adjacent to loops, bulges, and helix termini were not considered because the terminal or closing base pairs may be dynamic. Most average distances from the X-ray and NMR structures agreed within 0.3 Å (Table 1 ). In X-ray structures, 26 interbase average imino proton distances were <5 Å, thus allowing "imino proton walks" to identify helices. 60 The exceptions were 5′UA/ 3′AU, 5′UG/3′AU, 5′UG/3′GU, and G to U in X-ray structures of 5′CG/3′GU. Thus, helices with these doublets may not be completely constrained by NMR data. In published NMR spectra, however, an NOE between H3 of uracils of 5′UA/3′AU was observed for a human R/G stem-loop 61 and a hairpin stem from Yersinia enterocolitica. 62 In contrast, a 64 have an NOE between either imino proton of the GU pair and UH3 of the AU pair, but these NOEs were not observed in the spectrum of r(GUGAAUUUAC) 2 reported here. For the 5′CG/3′GU doublet, an NOE was observed between H3 of U and H1 of the 5′ G in NMR spectra of a mutant of an element of the 3′ UTR of turnip crinkle virus 65 and a domain of medaka telomerase CR4/5. 66 Sometimes spin diffusion will produce imino−imino proton NOEs even if the imino protons are separated by >5 Å. 60 Thus, complete helical walks are more likely to be observed than expected for the distances in Table 1 . Spectral Analysis of Duplexes with GU Pairs. To expand the database for GU pairs, exchangeable protons of short duplexes were assigned from NOESY spectra and the nonexchangeable H5 and H6 protons of C and U were assigned from TOCSY spectra (Tables S2−S13). CH5−H41/42 crosspeaks in NOESY spectra differentiated C from U in the TOCSY spectra and initiated assignment of proton resonances. Imino protons were identified as those of GU, GC, or AU pairs based largely on their positions in the imino fingerprint regions, from 10 to 12 ppm for GH1 and UH3 with a strong GH1/UH3 cross-peak for GU pairs, from 11 to 13.5 ppm for GH1 in GC pairs, and from 13 to 15 ppm for UH3 in AU pairs. 60 Aromatic proton assignments were confirmed with sequential aromatic walks. In A-form RNA, H1′ of a residue forms NOE contacts with its own H6 or H8 base proton and that of its 3′ base, allowing sequential assignments. 60 H2 of adenosine has an intrastrand cross-peak to H1′ of its 3′ residue and an interstrand cross-peak to H1′ of the residue 3′ of the base to which it is paired. While NMR spectra for all duplexes used in this study were assigned with similar methods, an example of the process for r(GAGGAUCUUC) 2 is given below. Two others are given in the Supporting Information. 2D NOESY spectra for r(GAGGAUCUUC) 2 were obtained with mixing times of 100 and 400 ms at 5 and 20°C, respectively. The G3 H1 and U8 H3 protons were assigned according to their positions in the imino region of the 100 ms spectrum ( Figure 2 ). G4 H1 was identified by its cross-peaks to U8 H3 and G3 H1, while G1 H1 displays a weak resonance due to exchange with water. H3 of U6 was differentiated from U9 by its cross-peak to G4 H1. H5 to H6 peaks corresponding to C7 and C10 were differentiated by cross-peaks from the former's H41 and H42 to G4H1. Remaining aromatic proton and H1′ assignments were made with the 400 ms spectrum as described above (Figure 2 ). The H1′ assignments of U6 and C7 were confirmed by NOE contacts to A5 H2, while those of G3 and C10 were confirmed by NOE contacts to A2 H2. Database. NOEs from imino proton resonances provide identification of intrabase pair resonances for H5 of C and U and H2 of A. 60 A database of such NMR chemical shifts was assembled for 78 GU wobble pairs, 292 AU pairs, and 490 GC pairs flanked on both sides by at least one canonical base pair and categorized according to the identities and orientations of the flanking canonical pairs. Most of the structures were 10−40 nt long and contained stem-loops, while a few were completely double-stranded RNA. Literature data were mostly obtained from the BMRB. 45 Chemical shifts determined for GH1, UH3, and UH5 protons of GU pairs, AH2, UH3, and UH5 protons of AU pairs, and GH1 protons of GC pairs on the basis of oligoribonucleotide spectra reported here were consistent with existing data. The expanded database showed strong sequencedependent patterns, which were used to determine chemical shift ranges that identify the 5′ to 3′ direction of base pair triplets centered on GU, AU, and GC pairs ( Table 2) . For GU pairs, a 2D plot of UH3 versus GH1 chemical shifts ( Figure 3 ) revealed well-defined clusters for 5′RGY3′ and 5′YGR3′, but 5′RGR3′ and 5′YGY3′ regions overlap, where R and Y represent purines (G or A) and pyrimidines (C or U), respectively. A 2D plot of UH5 versus GH1 chemical shifts contained well-defined clusters corresponding to 5′RGY3′, 5′YGR3′, and 5′YGY3′, but not 5′RGR3′ due to overlap with the 5′YGR3′ region ( Figure 3 ). Thus, if triplets have a central GU pair, then GH1, UH3, and UH5 chemical shifts often reveal the direction of the helix (Figures 3 and 4) . For AU pairs, 2D plots of AH2 versus UH3 chemical shifts ( Figure 5 ) revealed defined clusters corresponding to 5′RAY3′ Figure 5 . Chemical shift patterns for AU pairs. AH2 vs UH3 (top), UH5 vs UH3 (middle), and UH5 vs AH2 (bottom) colored according to triplet type. For each triplet type, R is purine (A or G) and Y is pyrimidine (C or U). Circled points represent chemical shifts not previously reported in the literature. Colored boxes are chemical shift ranges used as direction-dependent constraints for triplets with the same color points. Apparent overlaps in these plots are resolved by including a third chemical shift ( Figure 6 ). . Chemical shift patterns for GU pairs. UH5 vs UH3 vs GH1 chemical shifts colored according to triplet type. and 5′YAR3′, but the 5′RAR3′ region overlaps with 5′YAY3′. A 2D plot of UH3 versus UH5 chemical shifts contained welldefined clusters corresponding to 5′RAY3′ and 5′YAY3′, but the 5′RAR3′ region overlaps with 5′YAR3′. Thus, if triplets have a central AU pair, then UH3, AH2, and UH5 chemical shifts often reveal the direction of the helix (Figures 5 and 6 ). For GC pairs flanked by canonical base pairs, a plot of the distribution of GH1 chemical shifts (Figure 7) showed that no GC pairs in the 5′RGY3′ direction have a GH1 chemical shift below 12.40 ppm, whereas no GC pairs in the 5′YGR3′ direction have a chemical shift above 13.10 ppm. Thus, if triplets have a central GC pair, then a GH1 chemical shift below 12.40 ppm eliminates the 5′RGY3′ direction and a shift above 13.10 ppm eliminates the 5′YGR3′ direction. NAPSS-CS Algorithm. The NAPSS-CS program identifies helices from a sequence by applying NMR constraints to a dynamic programming algorithm (Figure 8 ). This algorithm generates a free energy dot plot for a given sequence and recursively searches it for helices or sets of helices that fully match helical walk constraints from NMR. As in the previous version, 39 NAPSS-CS considers imino walks across singlenucleotide bulges and also coaxial stacks if the helices are not in separate pseudoknots. In NAPSS-CS, experimental chemical shifts for GH1, UH3, and UH5 in GU pairs, AH2, UH3, and UH5 in AU pairs, and GH1 in GC pairs can be input, which may define the orientation of base pairs in helices (Table 2) . To reduce the search space, NAPSS-CS looks for the dot plot with the minimal number of pairs needed to find at least one complete match to all the helices revealed by NMR. Starting with the dot plot with pairs in the predicted most stable structure based only on thermodynamics, the number of pairs in the dot plot is increased by allowing base pairs found in structures generated at less favorable free energy changes. The allowed free energy difference between the predicted most favorable free energy change and that used as a cutoff for finding new potential base pairs is gradually increased in 1% increments until there is at least one match for all of the helices revealed by NMR. Chemical exchange with water may prevent detection of imino protons of terminal base pairs and/or NOEs from those protons to imino protons of adjacent base pairs from being identified in NMR spectra and included in imino walk constraints. Therefore, the program extends matched helices to canonical base pairs that can stack on the matched helices. For every extended match set, NAPSS-CS forbids alternative pairings for the nucleotides in the set, uses a dynamic programming algorithm to fold the RNA into a secondary structure by free energy minimization, and then re-forms the base pairs from the match set if they have not already been reformed by the dynamic programming algorithm. Because nucleotides are not allowed in matched base pairs to base pair . Distribution of GH1 chemical shifts for GC pairs colored according to triplet type. For each triplet type, R is purine (A or G) and Y is pyrimidine (C or U). No GH1 chemical shifts from 11.31 to 11.50 ppm were found for GC pairs. to any nucleotide other than its matched partner, helices that are pseudoknotted once the matched base pairs are added are allowed to form. 67 Similar to the ShapeKnots algorithm, 38 NAPSS-CS fills in single or tandem mismatches and removes isolated pairs. The latter eliminates possible nonsensical pseudoknots. NAPSS-CS then calculates the folding free energy for every structure with the extended matches still intact. The free energy change for nonpseudoknotted secondary structures is calculated with the INN-HB model. 68, 69 Free energy changes for structures with pseudoknots are calculated by adding three energy terms: (a) the free energy change of the structure with the pseudoknot removed (maximizing the number of remaining base pairs) 70 using the INN-HB model, (b) the energy of the helix(es) that was removed when breaking the pseudoknot, calculated with the INN-HB model (without intermolecular initiation or any loop free energy changes), and (c) a pseudoknot energy penalty introduced in the ShapeKnots algorithm. 38, 71 If available, additional constraints or restraints can be used to further reduce the folding space. These include restraints from SHAPE and other mapping experiments or pairing constraints that can be derived, for example, from sequence comparison. Application of NAPSS-CS to HAR1 and B. mori R2 Retrotransposon RNAs Illustrates the Method. HAR1 is a rapidly evolving noncoding RNA discovered in the brains of chimpanzees and humans. 8 Two secondary structures were initially proposed for HAR1, but NMR spectra 10 confirmed the secondary structure proposed by Beniaminov et al. 9 (Figure 9 ). To expand on published NMR spectra, new spectra were measured for HAR1 ( Figure 10 and Figures S3−S5) . NOESY and 15 N− 1 H HSQC spectra (Figure 10 and Figures S3 and S4 ) acquired at 25°C revealed 17 G and 8 U imino peaks, corresponding to 15 GC pairs, 6 AU pairs, and 2 GU pairs. An additional AU and GU pair was identified in a NOESY spectrum acquired at 15°C ( Figure S5 ). These data are consistent with seven imino proton walks (Figures 9 and 10 and Figures S3−S5) . The imino proton chemical shift data from this work (Table S14 ) agree well with those reported by Ziegeler et al. 10 Imino proton resonances not identified in this work that Ziegeler et al. 10 assigned only in fragments of the fulllength construct are for G1, G48, and U109. These resonances were likely difficult to assign in the full-length construct because Figure 10 . NMR spectra of human HAR1 showing imino proton walks for helix P1 (see Figure 9 for the secondary structure). The top spectrum is a 1 H− 1 H NOESY spectrum acquired at 25°C with a 125 ms mixing time. Colored lines depict imino proton walks for helix P1 and correspond to base pairs in Figure 9 with the same colors. Colored dots represent base pair type (red for GC and blue for AU). Sequences of dots for imino proton walks are in the bottom right of the spectrum. Blue and green boxes around sequences of dots correspond to blue and green base pairs in Figure 9 . The bottom spectrum is a 15 N− 1 H HSQC spectrum acquired at 25°C. Figure 9 . Secondary structure of human HAR1. Colored base pairs correspond to imino proton walks identified from NMR spectra ( Table 3) . Residue numbering in the structure reported in this work is shifted by three residues relative to the consensus sequence. 9 they exchange with solvent protons in solvent-accessible environments: G1 and U109 are located at the end of helices, and G48 is in a GA pair. Imino proton resonances that Ziegeler et al. 10 did not assign in the full-length construct but were identified in this work are for G19, G30, G44, G49, G51, U79, U80, and G104 (Table S14 ). On the basis of the secondary structure shown in Figure 9 , P2 and P4 were missing expected imino signals and the two pairs assigned to P4 could be observed only at a reduced temperature (15°C) and a reduced mixing time (60 ms). These observations suggest that P2 and P4 may be unstable and/or dynamic. Constraints used for HAR1 are listed in Table 3 . The 75 nt B. mori R2 retrotransposon pseudoknot ( Figure 11 ) has NMR spectra that agree well with those of a 74 nt construct ( Figure 11 ) originally used to identify the same pseudoknot. NOESY and 15 N− 1 H HSQC spectra (Figures S6−S9) acquired at 25°C revealed imino resonances corresponding to 20 GC pairs, 4 AU pairs, and 1 GU pair. These data provided six imino Figure 11 . Pseudoknotted structures used to benchmark NAPSS-CS. Colored base pairs correspond to imino proton walks identified from literature NMR spectra (Tables S16−S24) . Table 3 . NMR Constraints Used To Predict the Structure of HAR1 a a Colors correspond to those in the secondary structure of Figure 9 and the imino proton walks shown in Figure 10 . Chemical shifts are submitted to NAPSS-CS as shown on the left, and base pairs predicted by NAPSS-CS are shown on the right. Integers 5, 6, and 7 represent AU, GC, and GU pairs, respectively. For GU pairs, numbers in parentheses are chemical shifts of GH1, UH3, and UH5, respectively. For AU pairs, numbers in parentheses are chemical shifts of AH2, UH3, and UH5, respectively. For GC pairs, the first number in parentheses is the chemical shift of GH1. For GU and AU pairs, zero means an unavailable chemical shift. For GC pairs, the second two zeros are placeholders for absent chemical shift constraints. Chemical shifts (Table S14) proton walks (Figure 11 and Figures S6−S9) . One walk is new because G32 is able to pair with C75 in the 75-mer ( Figure 11 and Figure S8 ). Unlike in the spectra of the 74 nt construct, 39 an NOE from G13 to G27 was not observed in the spectrum of the 75 nt construct, possibly because its sample concentration was lower than for the 74 nt construct. This reduced a previous walk of 5 bp to two separate walks of 3 and 2 bp. Constraints used for the 75-mer B. mori R2 pseudoknot are provided in Table S17 . While not used as a constraint, an imino proton resonance at 12.31 ppm was assigned to G9 in the 75 nt construct, consistent with formation of an imino G9-A30 pair. Accuracy of Structure Prediction. The NAPSS-CS algorithm was tested on a total of 18 structures, nine of which contain pseudoknots (Figures 9 and 11 and Figure S10 ). NMR constraints for these sequences are provided in Table 3 and Tables S16−S32. The average sensitivity and PPV were calculated over all 18 structures. A one-tailed, paired t test was performed to test the significance of the improvement in sensitivities and PPVs from constrained NAPSS-CS as compared to those from three other algorithms without restraints ( Table 4 ). The null hypothesis (H 0 ), stating that NAPSS-CS is not more accurate than an alternative program, was tested. Constrained NAPSS-CS was found to have a sensitivity (p < 0.05) significantly higher than those of Fold, 20 ProbKnot, 72 and ShapeKnots, 38 and a PPV significantly higher than that of ProbKnot (Table 4) . For structures with pseudoknots, the sensitivity and PPV for pseudoknotted base pairs were calculated separately with eqs 2 and 3. Pseudoknotted base pairs are those that form between single-stranded and loop bases and close the loop involved in formation of those base pairs (see Methods). Pseudoknotted base pairs were predicted considerably better with the constrained NAPSS-CS algorithm than with unrestrained programs ( Table 5 ). The average pseudoknot sensitivity and PPV for NAPSS-CS are 95 and 88%, respectively, compared to ≤33% for each of the other programs when unrestrained. Six of the nine sequences were predicted to be pseudoknotted only by constrained NAPSS-CS. Both SHAPE 73 and NMR 39 data are only available for the 74 nt B. mori R2 retrotransposon pseudoknot. When two strong and two moderate SHAPE hits 73 were used as restraints with reactivities of 0.8 and 0.4, respectively, ShapeKnots predicted a structure with 58% sensitivity and PPV for all base pairs, but with no pseudoknotted base pairs. In contrast, NAPSS-CS with only NMR constraints predicted a structure with a sensitivity and PPV of 83 and 91% of all base pairs (Table 4 ) and 79 and 85% of pseudoknotted base pairs (Table 5) , respectively. Aside from the 18 structures whose prediction accuracies are reported, NAPSS-CS failed to give results for two additional structures ( Figure S11 ). The Kluyveromyces lactis telomerase RNA pseudoknot 74 contains a helical walk across a single base pair (C22-G36), which is not allowed by the dynamic programming algorithm. The MLV recording signal pseudoknot 75 has a helical walk across coaxially stacked pseudoknots, which is not supported by NAPSS-CS. 39 Aside from the two structures, little evidence of walks across these arrangements of base pairs exists in the literature. 39 For that reason, NAPSS-CS is designed not to support these structures. 


Section:■ results