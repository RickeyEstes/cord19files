The previous sections used ExpCMs, which are mutationselection models that use site-specific amino-acid preferences that have been measured by experiments. However, there are other mathematically similar implementations of mutationselection models that infer the amino-acid preferences directly from the natural sequence data. When these models are designed for use in phylogenetic inference, they are generally implemented in a Bayesian framework, which avoids the overfitting problems associated with trying to make maximumlikelihood estimates of the thousands of amino-acid preference parameters . (Note that the maximum-likelihood implementations of Tamuri, dos Reis, and Goldstein (2012) and Tamuri, Goldman, and dos Reis (2014) are designed for estimating the amino-acid preferences, not for phylogenetic inference.) The model most comparable to our ExpCMs is the codon mutation-selection model implemented in PhyloBayes-MPI, which we will refer to as pbMutSel (Rodrigue and Lartillot 2014) . In the pbMutSel model, the amino-acid preferences are modeled using Dirichlet processes rather than derived from experiments. However, like an ExpCM, a pbMutSel model still assumes a single set of time-homogeneous site-specific amino-acid preferences for the entire tree. Comparing ExpCM and pbMutSel models can help determine the ultimate limits of mutation-selection models that assign each site a single set of amino-acid preferences. If the limitations of ExpCMs described above arise simply because the deep mutational scanning experiments do not correctly measure the 'true' amino-acid preferences across the entirety of a highly diverged phylogenetic tree, then we would expect the pbMutSel models (which infer these preferences from the entire tree) to perform better. On the other hand, if the major limitation is that no single set of time-homogenous amino-acid preferences can fully describe evolution over the entire tree, then we would expect ExpCM and pbMutSel models to perform similarly. We fit a pbMutSel model to the entire HA phylogenetic tree, and compared the results to those from analyzing the same tree with the best ExpCM, which is the ExpCM(H1þH3 avg)þCx variant. This is a direct apple-to-apples comparison, since the pbMutSel model also draws x from a gamma-distribution (Rodrigue and Lartillot 2014) . First, we compared the amino-acid preferences inferred by the pbMutSel model to the preferences Figure 6 . The congruence between natural selection and the deep mutational scanning measurements decreases with sequence divergence. We fit an ExpCM informed by the H1 or H3 deep mutational scanning experiments to trees spanning sequences with low, intermediate, and high divergence from the sequence used in the experiment. The ExpCM stringency parameter (b) is a measure of the congruence between natural selection and the experimental measurements (Bloom 2014b; Hilton, Doud, and Bloom 2017) . Larger values of b indicate that natural selection prefers the same amino acids as the experiments but with greater stringency. As divergence increases between the HA used in the experiment and the other sequences in the tree, the b value decreases and the amino-acid preference 'flatten'. Therefore, the preferences measured in each experiment are progressively less congruent with natural selection as we include increasingly diverged sequences. measured in the experiments. Figure 7a shows that the preferences inferred by pbMutSel are quite similar to the (H1þ H3 avg) obtained by averaging the deep mutational scanning measurements for the H1 and H3 HAs. Notably, the amino-acid preferences from the pbMutSel model are more correlated with the (H1þ H3 avg) than the H1 and H3 measurements are with each other (Fig. 7a) . This strong correlation indicates that the ExpCM(H1þH3 avg)þCx is unlikely to be much different than a pbMutSel model that is parameterized only using the natural sequence data. We next compared the branch lengths estimated by using the ExpCM(H1þH3 avg)þCx and pbMutSel models. As shown in Fig. 7b , these two models estimated similar branch lengths across the entire HA phylogenetic tree. However, the estimates are not identical, and the tension between local and global accuracy of the amino-acid preferences is still apparent. Specifically, the branches leading to the H1 or H3 sequences used in the experiments were estimated to be slightly longer by the ExpCM, while some other branches were estimated to be slightly longer by the pbMutSel model. The relatively longer branches leading to the experimental sequences when using the ExpCM(H1þH3 avg)þCx suggests that the 'tree average' amino-acid preferences inferred by the pbMutSel model are not as accurate as the preferences from the deep mutational scanning for sequences close to those used in the experiments. However, for sequences distant from those used in the experiments, the 'tree average' preferences inferred by the pbMutSel model appear to be slightly better than the experimental values. Therefore, while the ExpCM and pbMutSel models differ slightly in the extent to which they lengthen different branches, neither model can avoid the tension between the local and global accuracy of amino-acid preferences. 


Section:a model with amino-acid preferences estimated from natural sequences gives similar results to an expcm