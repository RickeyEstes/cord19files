We applied kallisto to index five databases of different sizes and calculated the running time of the indexing step. Figure 1 shows that indexing time increases linearly with the size of the reference databases, and for the largest reference database of 2 GB, kallisto took 3 h and 38 min to generate the index file. To examine how running time changes with sample size, we created seven data sets with 1, 3, 5, 10, 20, 30, and 40 million reads respectively from the data described in Lee et al. (2017) and applied FastViromeExplorer, ViromeScan, and blastn. As blastn took too long to run on large data sets, we run blastn on only three data sets of size 1, 3, and 5 million reads respectively. Two databases, one containing all NCBI RefSeq viral genomes and the other containing 125,842 mVCs from Paez-Espino et al. (2016) , were used as the reference databases, to also examine the effect of reference databases on running time. Figure 2A shows the running time using the NCBI database as reference. FastViromeExplorer has the shortest running time for all the seven data sets. For the data set with 5 million reads FastViromeExplorer took only seven minutes, compared to 12 min for ViromeScan, 31 min for blastn. The speedup of FastViromeExplorer compared to ViromeScan became much more pronounced when a larger reference database was used. Figure 2B shows that when we used the larger reference database, for a data set with 5 million reads, FastViromeExplorer took 17 min, compared to 53 min for ViromeScan, and 4 h and 40 min for blastn. So FastViromeExplorer ran three times faster than ViromeScan and 16 times faster than blastn. For the largest data set with 40 million reads, FastViromeExplorer took 2 h and 27 min, a 2.5× speedup compared to ViromeScan that took 6 h and 23 min. Taken together, when using NCBI virus and phage database as reference, FastViromeExplorer takes on average about 1 min to process one million reads; when using a larger database (125,842 mVCs, 2GB), FastViromeExplorer takes 3-4 min to process one million reads, a 2-3× speed up compared to ViromeScan. Note that the indexing time (for both FastViromeExplorer and ViromeScan) was not counted in the running time shown (Fig. 2) as indexing needs to be computed only once. Once the index file is generated, it can be used to analyze any metagenomic data. Simulated datasets were initially used to compare the annotation performance of FastViromeExplorer with ViromeScan and blastn. Since viruses mutate fast, even if it is the same viral species, the viral sequences in the metagenomic data might not be exactly the same as their sequences in the reference database, it is therefore important to examine the performance of a virus detection tool taking into account virus's high mutation rate. We therefore simulated four data sets with different mutation frequencies (3%, 5%, 7%, and 10%) from the references and applied FastViromeExplorer, ViromeScan, and blastn. Figure 3 shows the F 1 score (Recall and Precision are given in Table S1 ). All the tools have had high Precision (99%) across all the data sets. But as mutation frequency becomes higher, the number of mapped reads is reduced and Recall becomes lower for all the tools. In terms of F 1 score, blastn has the best score, FastViromeExplorer has similar but slightly lower score, and ViromeScan has the lowest score. For the data set with the highest mutation frequency (10%), the F 1 scores for blastn, FastViromeExplorer and ViromeScan are 0.79, 0.7, and 0.43 respectively. But FastViromeExplorer took 2 min compared to blastn which took 8 min. Therefore, for these simulated data sets and using all eukaryotic viruses as the reference database, FastViromeExplorer runs four times faster than blastn while maintaining a similar F 1 score to blastn. To examine the performance of FastViromeExplorer in detecting and quantifying viruses on real data, we applied FastViromeExplorer to the fecal metagenomic samples collected from Lee et al. (2017) . Lee et al. followed the dynamics and consequence of fecal microbiota transplantation (FMT) by examining the metagenomics data from a donor's and recipients' preFMT and postFMT samples. They constructed 92 bacterial metagenome-assembled genomes (MAGs) from reads of the donor samples and examined the occurrence of the MAGs in the recipient samples. They found that the bacterial MAGs that were present in the donor samples and also colonized the recipient samples after FMT mostly belonged to the order Bacteroidales. Here we examined the dynamics of viruses/phages to see whether it is consistent with the finding of Lee et al. (2017) . From the result of FastViromeExplorer using the 8,957 NCBI RefSeq viral genomes as reference, we observed that only three viruses (Human endogenous retrovirus K113, Glypta fumiferanae ichnovirus segment C10, and Lactococcus prophage bIL311) were found in all four donor samples, with human endogenous retrovirus K113 being the most abundant for samples 1, 3, and 4, and Lactococcus prophage bIL311 the most abundant in sample 2. For the recipient, 30 viruses were found in the preFMT sample whereas only five were found in the two postFMT samples. Among the five viruses, only Lactococcus prophage was also found in one donor sample. But as this prophage was also present in the preFMT sample, we cannot conclude that the virus was transferred from the donor to the recipient. Overall, using the NCBI RefSeq database as the reference, we only detected 38 viruses in the FMT samples, and this result reveals no clear evidence of virus/phage transfer from the donor to the recipient. This result indicates that as our tool is a reference-based virus detection tool, having a suitable and/or complete reference database is important for performance. We also applied ViromeScan to the fecal samples with its default reference database containing 4,370 eukaryotic DNA/RNA viruses. ViromeScan identified 847 viruses in all the samples. Compared to ViromeScan's reference database, ours is two times bigger and it is thus surprising that ViromeScan identified a lot more viruses than FastViromeExplorer. Analysis of the ViromeScan result shows that the most abundant virus, Encephalomyocarditis virus, has all the reads mapped to a repeat region of its genome (see Fig. S3 ), indicating that the annotation is likely false positive. In fact, Encephalomyocarditis virus was also present in the initial result produced by FastViromeExplorer, but was discarded after the first filtering step. To further examine the effect of our three filtering criteria, we applied them to the ViromeScan result. Figure 4 shows that most of the viruses were filtered out and only Human endogenous retrovirus K113 and Glypta fumiferanae ichnovirus remained, both of which were also present in the final result of FastViromeExplorer. The finding here shows the importance of the filtering criteria in removing viruses that might be annotation artifacts caused by repeats, low coverage, and small genome sizes. Since the analysis of the fecal samples using the default NCBI viral database did not reveal anything meaningful about fecal microbiota transplantation from the donor to the recipient, we tried FastViromeExplorer again using the 125,842 metagenomic viral contigs (mVCs) collected from Paez-Espino et al. (2016) as reference. These mVCs are mostly unknown partial or complete viral genomes but have been predicted/annotated for their possible hosts and the host information of the mVCs is made available through the IMG/VR website (Paez-Espino et al., 2016; Paez-Espino et al., 2017) . Therefore, the predicted host information of the mVCs, collected from the IMG/VR website, can be used to examine the result. Using these mVCs as reference, our tool detected 3,479 viral contigs in the FMT samples. Figure 5 shows the relative abundance of host bacteria across all donor and recipient samples. The order Bacteroidales is more abundant than the order Clostridiales in all donor samples. For the recipient, prior to FMT, the order Clostridiales clearly dominated the microbiota, however, after the transplantation, the abundance of phages infecting the order Bacteroidales increased dramatically and the abundance of the order Clostridiales decreased greatly. This result indicates that phages with host bacteria from the order Bacteroidales were either successfully transferred or greatly enriched as a result of the microbiota transplantation from the donor to the recipient. For example, in donor samples, ''SRS049900_LANL_scaffold_14438'' is one of the most abundant mVC, being the most abundant in donor samples 1 and 2, and the second most abundant in samples 3 and 4. This mVC was not present in the recipient's preFMT sample but was highly abundant in the postFMT samples, suggesting either the successful transferring of the mVC from the donor to the recipient or the great enrichment of the mVCs in the recipient as a result of FMT. As the host of this mVC is from the order Bacteroidales, this suggests the successful colonization of bacteria from the order Bacteroidales from the donor to the recipient. Therefore, our result on phage transfer following the FMT is consistent with the observation on bacterial colonization following the FMT shown in the original study (Lee et al., 2017) . The detailed annotation result is given in Table S2 . Consequently, when we applied FastViromeExplorer to the samples using a larger reference database, our tool detected 3,479 viral contigs which was much greater than the number of viruses detected using NCBI RefSeq database (38 viruses). Using a larger reference database, a much clearer correlation between our results and the biological results reported in the original paper emerges, highlighting the importance of having larger and more complete reference databases. We also applied FastViromeExplorer to ocean microbiome samples collected at multiple time points from Aylward et al. (2017) . This study assembled 483 viral scaffolds (NCBI accession numbers NTLX01000001.1-NTLX01000483.1) from the metagenome reads from 44 ocean samples. In our study, we tried to find if FastViromeExplorer could rapidly identify dominant viral components directly from the read files using both the JGI 125,842 mVC data set collected from Paez-Espino et al. (2016) as well as the GOV dataset containing 298,383 epipelagic and mesopelagic viral contigs collected from Roux et al. (2016) . Results show that FastViromeExplorer was able to successfully identify some contigs that resemble the original 483 scaffolds. For example, while using the 125,842 mVCs as reference, the most abundant mVC was ''GOS2241_1000284'', which according to blastn aligns with scaffold ''NTLX01000031.1'' with identity 76.33% and alignment length 562 bp. Another example was mVC with id ''JGI25127J35165_1001802'' which has similarity with the longest scaffold ''NTLX01000001.1''. In addition while using the GOV contig set (Roux et al., 2016) as reference, we identified an abundant contig with id ''GOV_bin_1783_contig-100_1'' with 98.35% identity and 2,004 bp alignment length with scaffold ''NTLX01000307.1''. These successful hits could subsequently be used to assemble the actual viral sequences found in the samples. Taken together, our results show that FastViromeExplorer can also be applied to detect and quantify viruses and phages in metagenomic samples taken from environmental samples, and the results are accurate if given a sufficiently complete reference database. 


Section:results and discussion