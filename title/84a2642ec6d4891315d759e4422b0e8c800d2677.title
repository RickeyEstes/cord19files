Anomaly detection based on a dynamic Markov model