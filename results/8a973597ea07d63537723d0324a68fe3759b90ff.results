In the recent literature, the term 'bottleneck' has been applied to describe a reduction in the genetic diversity of a population (e.g. [56] ), whether arising from selection or a numerical reduction in the size of a population. Here, we define a 'bottleneck' more strictly as a neutral process whereby a finite number of viral particles from one population found a subsequent generation of the population, either within the same host, or across a transmission event from host to recipient. Selection then constitutes a modification to this process whereby some viruses, because of their genotype, have a higher or lower probability of making it through the bottleneck to found the next generation. We applied a population genetic method to make a joint inference of the bottleneck size and the extent of selection acting during a transmission event. We consider a scenario in Challenges arising in the inference of transmission bottlenecks from viral sequence data. Circles represent idealised viral particles characterised by four distinct alleles. A. Reductions in population diversity cannot necessarily be attributed unambiguously to either a population bottleneck, or the action of selection. In the illustrated case, either a tight bottleneck without selection or a large bottleneck with strong selection could explain the change in the population during transmission. B. Straightforward statistics describing a population may generate misleading inferences of population bottleneck size. In the illustrated case, the genetic structure of a population is changed by a population bottleneck during transmission, but the frequency of each allele within the which a viral population is transmitted from one host to another, with samples being collected before and after the transmission event (Fig 2A) . In our model viruses are categorised as haplotypes, according to the alleles they harbour at polymorphic sites in the genome. Such haplotypes are not directly observable from short-read sequencing data. However, after identifying polymorphisms in the data it is possible to use short-read data to identify a set of haplotypes which collectively explain the observed sequence data across the course of a transmission event [52, 57] . The viral population is then represented as a vector of frequencies of haplotypes in this set; the population before transmission is represented by the vector q B (B denoting 'Before transmission'). During transmission, a random sample of N T viruses are passed on to the second host to give the founder population q F . Selection for transmissibility, whereby genetic variants cause some viruses to be more transmissible than others, is described by the function S T . The potentially small size of the founder population means that the population evolves within the host under the influence of genetic drift to create the large post-transmission population q A (A denoting 'After transmission'); this process is approximated in our model by a Wright-Fisher sampling process (representing genetic drift) with effective population size N G . Selection acting for within-host growth may further alter the genetic composition of the population; this effect is described by the function S G . Our method thus allows for a discrimination to be made between selection for increased within-host replication and selection for increased viral transmissibility. Observations of the population are collected before and after transmission via a noisy sequencing process to give the datasets x B and x A . The extent of noise in the sampling and sequencing is characterised by the parameter C [52, 57] . Noise in our study was considered in terms of the precision with which the frequency of a variant can be specified by viral sequence data. Variant frequencies are measured in terms of the number of reads which report a given allele; in the absence of noise the uncertainty in the frequency would be that arising from a binomial distribution. Our noise parameter C describes the extent to which this uncertainty is increased. Smaller values of C increase the variance, reaching that of a non-informative uniform distribution at C = 0 whilst larger values represent lesser additional uncertainty, tending towards the binomial limit as C ! 1 (S1 Fig). Elsewhere we have noted that the parameter C and the absolute read depth of a sample can be converted into an 'effective depth' of sequencing [54] . In the limit of very deep sequencing the variance of an allele frequency tends towards that of a binomial distribution with sampling depth C + 1. To summarise our approach, we note that both the transmission and within-host growth events can be represented as sampling processes, which may each be biased by the effect of selection. As such, given an estimate of the noise inherent to the sequencing process, and externally-derived estimates for N G and S G , we can calculate an approximate likelihood for the parameters N T and S T given the observations x B and x A . Maximising this likelihood gives an estimate for the size of the transmission bottleneck and the extent to which specific genetic variants within the pre-transmission population confer increased transmissibility upon viruses. In our model we discriminate between changes in a population arising from selection and those arising due to the population bottleneck. This is achieved by considering regions of the genome between which recombination or reassortment has removed linkage disequilibrium between alleles ( Fig 2B; compare with Fig 1A) . As transmission involves whole viruses, the bottleneck N T is preserved between regions. Meanwhile, in the absence of epistasis, selection population does not change; an inference of bottleneck size derived from single-locus statistics would incorrectly be very large. C. Noise arising from the process of collecting and sequencing data is likely to produce differences between the observed populations, even in the event that the composition of the viral population was entirely unchanged during transmission. https://doi.org/10.1371/journal.pgen.1007718.g001 Inferring parameters of transmission from viral sequence data A set of haplotypes exists at frequencies q B from which a noisy observation x B is made. During a transmission event, a total of N T viruses are transferred under the influence of selection S T , establishing an infection in the next host described by q F . Growth of the viral population within the host then occurs to produce the population q A , influenced by genetic drift (characterised by the effective population size N G ) and selection S G . Sampling of the final population gives the second observation x A . B. Regions of the genome which are separated by recombination or reassortment are used to distinguish the effects of selection and a population bottleneck. Prior to transmission, the first region contains seven different genotypes spanning four variant loci whilst the second region harbours four genotypes covering three loci. As recombination between these two regions leaves them unlinked, selection acting on genotypes in one region has no impact on the fate of genotypes in the other region. Thus, where genetic diversity is reduced in the first region, the preservation of diversity in the second region attributes this change to the action of selection on the first, rather than a shared, and narrow, population bottleneck. C. Models of neutrality and selection are compared, as illustrated in this simplified diagram. Black dots represent observations x B and x A while the red dot indicates the inferred expected position of q A . The solid line joining these (b,c) indicates the inferred action of selection, with dotted lines showing components of this vector (c). The blue circle represents the optimised variance in the position of q A ; the length of its radius, shown as a dashed line, is inversely related to the bottleneck size. In the neutral case, the difference between observations is explained by the bottleneck alone. More complex models of selection fit q A more closely to x A and with reduced variance, giving higher inferred values of N T . https://doi.org/10.1371/journal.pgen.1007718.g002 Inferring parameters of transmission from viral sequence data acting upon one region of the virus does not influence the composition of the population in other parts of the genome. As such, a calculation encompassing multiple parts of the genome can estimate both N T and the influence of selection; in the figure the case of a loose population bottleneck, with selection acting upon the first region is preferred. A model selection process [58] is used to distinguish models of neutral transmission from evolution under selection ( Fig 2C) . A full exposition of the model is given in the Methods section. Here we used simulated data to evaluate the performance of our model under different circumstances. Having established the effect of sequencing noise on the inference of population bottlenecks, we demonstrate the ability of our method to correctly infer population bottlenecks from sequence data in the presence or absence of selection, and its ability to correctly identify variants conferring a benefit for viral transmissibility. We then applied our model to evaluate selection and population bottlenecks in a recently published transmission experiment [25] , involving two sets of viral transmissions. Here Moncla et al. identified a 'loose' bottleneck in the first set of transmissions which became more stringent and selective in the second set. We here infer bottlenecks of around 2-6 viruses for each set of transmission events and identify a number of sites under selection for within-host adaptation. However, no evidence was found for the presence of selection for enhanced transmissibility. As we go on to show, where few viruses are transmitted, inferring selection for increased transmissibility is an inherently difficult task. 