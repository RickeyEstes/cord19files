A linear model was fitted to the group of simulations cases 1-4 and cases 5-8 in order to investigate how memory, in terms of different intensity functions, may affect processes with either same basic reproduction number or same Malthusian parameters. The result of the statistical analysis is shown in Table 2 . From the simulations in Scenario 1, summarised in Fig. 4 , we find that memory can affect many of the shape features we compared. In particular, as the start of the infectious period n moves further from the time of infection, the tree imbalance increases. A negative or null slope of both standardised Colless and Sackin imbalance is rejected with a p-value p < 10 −8 for both cases 1-4 and cases 5-8. The frequency of cherries is unaffected by memory if the R 0 is kept constant (p = 0.48). For cases 5-8 the frequency of cherries is decreasing, having rejected the hypothesis of a null or negative slope (p < 10 −15 ). The frequency of pitchforks shows a slight increase for cases 1-4 in (p = 1.3 ⋅ 10 −6 ) and decrease for cases 5-8 (p = 1.5 ⋅ 10 −4 ). Similarly the "stairs 2" feature 55 increases as n increases for cases 1-4 where the R 0 is kept constant (p = 1.4 ⋅ 10 −4 ) and decreases for cases 5-8 where the Malthusian parameter is constant (p < 10 −15 ). The normalised number of internal nodes with a single tip descendant ("ILnumber"), maximum heights and average ladder length increase when both the R 0 is constant (p 1.9 ⋅ 10 −5 , < 10 −15 , 9.9 ⋅ 10 −9 respectively) and when the Matlhusian parameter is constant (all p < 10 −15 ). Whereas it is difficult to visualise most topological differences, the increase in imbalance, standardised maximum height and average ladder can be appreciated from the example trees related to Scenario 1 in Fig. 5 . for instance the tree in (S1 case5) is more balance and has smaller ladders, in proportion to its tips, than (S1 case7) or (S1 case8). However, the most dramatic difference between the various cases in Fig. 4 is in the number of tips. This was against expectation because the combinations final time-R 0 and final time-M were kept the same in cases 1-4 and 5-8 respectively (see Table 1 ). Particularly in cases 5-8 which have the same Malthusian parameter, the net growth is the same up to a (usually unknown) constant, and here it seems that this constant is highly dependent on the specific intensity function. This led us to ask whether the impact of memory on tree shapes in this context is just a matter of the impact of memory on the number of tips. To explore this question, we adjusted the time periods of the simulations to allow the different cases to produce branching trees of comparable sizes (Scenario 2). Fig. 6 shows the result. We now see lower differences between the processes. In the simulations where R 0 is kept constant, only the frequency of cherries, the "stairs 2" and the ILnumber show a statistically significant (p < 0.01) pattern. The cherry frequency and the "stairs 2" decrease (p of 0.2 ⋅ 10 −3 and 0.6 ⋅ 10 −3 respectively), whether the ILnumber increases as n increases (p = 0.3 ⋅ 10 −2 ). In the cases with constant M, more shape features showed statistically significant patterns. As the time between infection and the start of the infectious period grows, the cherry and pitchfork frequencies together with the "stairs 2" measure decrease (p of 10 −15 , 0.5 ⋅ 10 −3 , < 10 −15 respectively), whether the ILnumber, the maximum height and the average ladder increase (p of < 10 −15 , 0.3 ⋅ 10 −2 and 0.1 ⋅ 10 −3 respectively). Comparing to Scenario 1, adjusting for the size of the branching trees eradicates the some effects of memory, particularly in the simulations where R 0 is kept constant. In Fig. 5 , second row, some example trees for Scenario 2 were chosen. The shape difference between each other is not as evident as the trees from Scenario 1; there is a clear increase in the proportion of internal nodes with a one tip descendant (standardised ILnumber) from case 5 (11 nodes, 23 tips), to case 8 (14 nodes, 24 tips). As in Scenario 2, Scenario2-large shows an increased level of uncertainty (high p); see Fig. 7 and Table 2 for a summary of the results. Compared to Scenario 2, in Scenario 2-large the Colless and Sackin imbalance for cases 5-8 is decreasing (p of 3.5 ⋅ 1− −4 and 6.0 ⋅ 10 −4 ) instead of uncertain; the frequency of pitchfork for cases 1-4 increases (p = 7.7 ⋅ 10 −4 ) and is unchanged in cases 5-8; the standardised maximum height has an opposite Table 2 . Relation between shape topologies and memory, as included in our simulations. Memory is introduced by means of step-like intensity functions which vary by step position and height; refer to Table 1 for the details of each simulation. For both groups (cases 1-4 and cases 5-8) and for each shape topology, a straight line was fitted to the data and here it is reported whether the slope was negative, positive or if the linear fitting was inconclusive because of a p-value greater than 0.01. Similar p-values were also obtained with an ANOVA test. Specific values for intercept and slope are not reported, because of the high specificity of parameters used in the simulations and the standardization of the shape topologies. Scientific RepoRts | 6:21159 | DOI: 10.1038/srep21159 behaviour for cases 5-8; and the standardised average ladder for cases 5-8 does not show a statistically significant linear increase. We used two posterior collections of phylogenetic trees derived from the Kelowna TB outbreak in Canada (see Methods). From the collection of BEAST 60 estimates of the trees, birth and death rates were estimated. The estimated values were used to simulate the homogeneous trees in scenario BDFit, please refer to Table 1 for the input values used. Data-derived trees had slightly lower imbalance and slightly lower normalised maximum height than the simulated trees once size was controlled (Fig. 6) ; the two inference methods differed more with each other in several shape parameters (cherries, IL number and stairs) than the data trees differed from the simulations. Comparing to Scenario 1, the variability in the data-derived trees was typically much lower than that in the constant-rate models and more closely matched the tightly defined simulations in cases 3, 4, 7, and 8, but then the number of tips in the data is fixed, and the numbers of tips in cases 3, 4, 7 and 8 were the most narrowly distributed as well. Comparing to Scenario 2, where we controlled the average size, all of the tree shape features from the data are consistent with the simulations except for imbalance, maximum height and avgLadder feature. The BEAST trees were always closer to the constant-rate birth death model than the MrBayes trees, consistent with our having used the birth-death prior in BEAST. The fact that the number of tips varies dramatically while R 0 or M are fixed means that memory affects the number of lineages in the tree. This led us to wonder whether memory would affect the results of inference approaches that assume a memory-less model and use the timing of branching events. We estimated the birth rate using the pureBirth function in the laser package in R 63 . We found that the estimates varied, and that memory resulted in some bias. Since the trees are ultrametric, the estimate of the birth rate should be equal to the Malthusian parameter. With reference to Fig. 8 , the median estimate (shown by the horizontal bar in the boxplots) is too high in cases 1-4, correct in cases 5-8 in Scenario 1, but too high in cases 5 and 8 in Scenario 2. We also used Pybus' γ 64 to analyse the timing of branching events; this is possible for the ultrametric trees (Scenarios 1 and 2). We found that both memory, as we have explored it, and the distribution of the number of secondary infections, can affect whether trees appear consistent with the Yule model (see Supplementary Material) . We compared branching trees from a set of more extremely varying intensity functions such that the R 0 values differed greatly. Fig. 2(a) illustrates the intensity functions, which range from infectivity beginning immediately to infectivity beginning much later. We found that high R 0 values combined with a late intensity function resulted in marked differences in tree shapes, particularly in the numbers of cherries, pitchforks, the stairs feature, and the IL number, all with p < 10 −15 . The marked difference in shape is also evident in the examples in Fig. 5 . Imbalance is increasing with R 0 , with p 8,06 ⋅ 10 −10 and 4.1 ⋅ 10 −3 for Colless and Sackin respectively, as well as the maximum height (p = 2.0 ⋅ 10 −9 ). The number of tips and average ladder length are the only two shape features with no statistically significant difference among the three cases (p 0.87 and 0.06 respectively). A long delay between infection and start of infectious period causes the tree have only a few individuals with numerous offspring as in (S3 case2) and (S3 case3), compared to a more "normal" shape of (S3 case1). The extreme case (S3 case3) is composed by a handful of long caterpillars which imply low frequency of cherries and pitchforks and a high ILnumber, validating the results in Fig. 2 . Some of the shape features are naturally related to each other. For instance, connected "ladder" configurations will occur more frequently in imbalanced trees and cherries will be more numerous in balanced ones. Among measures of balance, Rogers 65 showed high correlation between Sackin and Colless imbalance, under the equal (1) . BD refers to the constant-rate birth-death process with R 0 = 1.5, and BDFIT refers to the constant-rate birth-death process with parameters inferred from data. BST and MB are trees inferred from data using BEAST and MB respectively. (see Table 1) rates Markov model and the equal probability model. With a simulation approach, Shao and Sokal 66 evaluated the correlation matrix of nine indices of tree balance under the equal probability model. Similarly, they found that Colless and Sackin are highly correlated with each other. We explored these correlations across our simulations and data ( Supplementary Figures S3-S6 ). We found that the correlations are remarkably preserved across the simulations, but that Case 8 and the latter 2 cases from Scenario 3 (all with high R 0 and delayed transmission), as well as the data, had correlation patterns which differed from the rest. Colless and Sackin imbalances are highly correlated in every simulation case, scoring a minimum of 0.88 (p < 10 −15 ) in Scenario 2 case 8. We did not find negative correlations between cherries and imbalance, though cherries indicate symmetry (near the tips) and imbalance indicates asymmetry (over the whole tree). Unlike other cases, case 8 consistently has a negative correlation between the ILnumber feature and the pitchforks: − 0.82 (p < 10 −15 ) in Scenario 1 and − 0.52 (p = 3, 5 ⋅ 10 −12 ) in Scenario 2. This negative correlation also occurs in the high R 0 cases from Scenario 3. In both data-derived groups of trees, the ladder numbers were not correlated with the imbalance measures whereas in most simulations these were tightly correlated. In the data-derived trees there were significant negative correlations between the stairs feature and the imbalance, height and ladder number, which were not present in any of the simulations. The data-derived trees had a weaker correlation between the ladder number and the imbalance than the simulations. In Scenario 3, many small but consistent correlations amongst tree shapes are reversed compared to the rest of the simulations; in particular, imbalance and tree height are not negatively correlated with cherries, pitchforks and stairs. These trees can have a high (1) . BD refers to the constant-rate birth-death process with R 0 = 1.5, and BDFIT refers to the constant-rate birth-death process with parameters inferred from data. BST and MB are trees inferred from data using BEAST and MB respectively. (see Table 1 ). imbalance simultaneously with high values of symmetric shapes such as cherries, for example. There are strong negative correlations between the number of ladder nodes (ILnumber) and the cherries and pitchfork numbers. Overall, when we compare how shape features have depended, or not depended, on the variations we have explored, we note that there are several shapes whose distributions were quite tightly constrained by data compared to their variability in simulations. These were the maximum height of the tree, the avgLadder feature and both measures of imbalance. In contrast, several shape features emerge as being sharply determined by the combination of high R 0 and M: the numbers of cherries and pitchforks, the stairs feature, and the number of internal nodes with a single tip descendant (ILnumber). 