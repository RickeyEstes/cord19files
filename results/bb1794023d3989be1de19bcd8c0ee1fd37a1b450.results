We developed a refinement protocol to detect and correct poorly modeled glycan configurations and to refine glycan coordinates guided by either low-resolution crystallographic data, via Phenix-Rosetta integration , or cryoEM density data. Of particular interest were the sugar rings of glycans, which may adopt a variety of different conformations with a range of energies ( Figure 1A) ; therefore, we designed our protocol to specifically address these ring conformations. For more on glycan ring conformations, see Agirre et al. (2017a) . Several glycan refinement-specific methods have been developed, including tools for automatic detection and setup of glycan-containing structures for subsequent refinement, a score term that enables cartesian refinement of carbohydrate chains, a dedicated routine for handling sugar ring stereochemistry, and a protocol for correcting the geometry of incorrectly built glycans while optimizing the fit to density. The protocol has a large radius of convergence and is able to make substantial modifications to the input models. For example, the protocol can refine high-energy sugar ring conformers into low-energy conformers and correct erroneous anomeric configurations (see Figure 1 ). Runtime is about six times slower than Phenix refinement: a 300 residue protein was refined in 25 min compared with 4 min for Phenix refinement alone. The approach is fully described in STAR Methods. To test our refinement protocol, we considered a benchmark set of 12 N-linked glycan-containing protein structures determined by X-ray crystallography at resolutions ranging between 1.9 Å and 3.5 Å and comprising a total of 133 glycan units. We identified four incorrect anomeric configurations and 23 highenergy ring conformations using the Privateer software (Agirre et al., 2015b) and detected by visual inspection that one structure was missing a glycosidic bond (Table 1) . We compared refinement of our Rosetta-based method with that of Phenix refinement alone and, for models with high-energy ring conformations in the input, Phenix refinement with constraints generated by Privateer (Agirre, 2017b; Gristick et al., 2017) . Following refinement of these 12 structures with our Phenix-Rosetta protein structure refinement pipeline, which alternates real-and reciprocal-space refinement, we were able to markedly improve the carbohydrate geometry, as assessed by Privateer. All the errors detected in the input coordinates were corrected in the output models. In particular, four incorrect anomeric carbon configurations were resolved by adjusting to the correct anomeric state and 23 high-energy ring conformations were refined into a corresponding low-energy conformation with only a slight decline in agreement to the experimental data, consistent with the idea that these glycans are being forced into poor geometry in order to over-fit the density ( Figure S1 ). The best alternative method tested, Phenix refinement with constraints from Privateer, was able to resolve only two of the four incorrect anomers and 12 of the 23 sugars in high-energy conformations (Table 1) . A comparison of real-space correlations of the refined and initial models, using both 2mFo-dFc density maps as well as polder omit maps (Liebschner et al., 2017) , is also shown in Figure S1 . While the geometry consistently improves following Rosetta refinement, the real-space correlations show mixed results: while in some sugars, we see a better fit to the data, in other cases we see a slight worsening. This might be due to the fact our relatively more-restrained model does a worse job at explaining the density resulting from heterogeneous conformations. To illustrate the improvements resulting from our protocol, we examined the structures of human IL-17AF (PDB: 5N92) and IgG1-Fc (PDB: 5K65). In the IL-17AF structure, fucose 507 was modeled with an incorrect beta configuration, which has been resolved to the correct alpha connection in the refined model ( Figure 1C ). In IgG1-Fc the fucose 507 is also problematic as it Glycan sugar conformations should always be modeled as chairs unless there is strong evidence to the contrary. (B) Two anomeric forms are shown, alpha with the glycosidic oxygen and the C5 carbon in trans, and beta in cis. The anomeric carbon is circled in red. (C) Fucose 507 of PDB: 5NSC has an incorrect anomeric connection in the input (magenta), and this is resolved in the refined model (blue). (D) Fucose 507 of PDB: 5K65 is in a high-energy ring conformation, and this is resolved in the refined model. (E) Asp 297 of chain B in PDB: 5K65 fails to form a glycosidic bond to the N-acetyl glucosamine. This is resolved in the output model, and the connection can be seen in the density after rephasing. All density maps are shown at a threshold of 1. is in a high-energy boat conformation that was automatically detected and corrected in the Rosetta-refined model, which has the expected low-energy 1 C 4 ( Figure 1D ). In the IgG1-Fc structure, the most proximal N-acetyl glucosamine of the N-linked glycosylation is not bonded to residue Asn 297 and does not properly fit the density. After refinement and rephasing, the carbohydrate moiety fits with better agreement to the electron density map and its covalent linkage to Asn 297 is properly formed ( Figure 1E ). These residues are also shown in the polder omit map ( Figure S2 ) (Liebschner et al., 2017) . 