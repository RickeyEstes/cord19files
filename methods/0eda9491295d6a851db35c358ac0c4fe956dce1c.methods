Data source. Hemagglutinin data of influenza viruses: HA1 sequences were collected from international databases and reports (Supplementary Note 2). A total of 14,891 HA1 sequences longer than 327 amino acids were retained for influenza A/ H3N2 and 16,672 HA1 sequences longer than 325 amino acids were retained for A/ H1N1. Based on a sequence identity of 99%, 1725 and 1284 unique HA clusters were formed for A/H3N2 and A/H1N1, respectively. Representative structures were built for each cluster with randomly selected sequences within the cluster via homology modeling (Modeller 9.11) 24 . The HI assay values were obtained for influenza A/H3N2 from the reports of international organizations along with published papers (Supplementary Note 2) . For strain a and strain b HA sequences, the antigenic distance D ab ð Þwas calculated only when the four individual HI values (H aa , H ab , H bb , H ba ) were available. In this way, 3867 D ab values for non-redundant HA pairs were derived from 288 unique HA sequences, covering 3539 strain pairs from 1968 to 2013, as different HA sequences were found under the same strain name. The dominant classification of each pairs could be detected following the protocol in Supplementary Note 3. Among the non-redundant HA pairs, 2286 were experimentally confirmed as immune-escaping according to HI results, whereas 1581 were defined as antigenically similar. We then split the data according to different time periods to simulate the prediction ability of each algorithm. In each simulated year (X), the selected supervised methods were trained by data collected from 1968 to X; and the remainder were used to testing data to evaluate the prediction ability. In this study, eight different time periods were selected (X = 1972, 1977, 1982, 1987, 1992, 1997, 2002 , and 2007) and tested respectively. Envelope protein data of dengue and zika viruses: E protein sequences were collected from the virus variation database of NCBI, with host set as human. A total of 4081 E protein sequences longer than 493 amino acids were retained for DENV 1-4 and 441 E protein sequences longer than 505 amino acids were retained for ZIKV. Based on a sequence identity of 100%, 1143 and 68 unique E protein clusters were formed for DENV and ZIKV, respectively. Representative structures were built for each cluster with randomly selected sequences within the cluster via homology modeling (Modeller 9.11) 24 . Epitope structure: A total of 421 PDB IDs that included 559 epitope structures were identified from the PDB 25 database, with key words including antibody, antigen, Fab, Fv, Fc, IgG, and immu*, with a resolution better than 3.0 Å and with a protein antigen length of more than 50 residues. For each PDB complex, epitope residues were determined by the nearest atom distance to antibody residues ( 4.0 Å). Finally, 559 epitope structures were defined as known conformational epitopes database in CE-BLAST. Algorithms. To align the two epitope structures, CE-BLAST first identifies the seed residue pairs in different subareas between the two structures. Subsequently, the alignment starts from the seed and gradually extends to the neighboring area to match the similar residue pairs. Then, the similarity score can be calculated according to the aligned epitopes. For each pair of queried epitope (A) and target epitope (B), the overall steps of the algorithm will be: Step 1: Identify the seed pairs between A and B via epitope fingerprints: Use the spin-image system to generate structural fingerprints for each epitope residue in epitopes A and B (see Structural fingerprint generation via the "spinimage" system); Add the physicochemical fingerprint (see Physicochemical fingerprint in the shell layers) to the structural fingerprint for each epitope residue. Identify the seed pairs based on the epitope fingerprints. Step 2: Use the "seed grow" strategy to find the most similar subclusters in epitopes A and B (see Epitope alignment based on the "Seed grow" strategy). Step 3: Calculate the overall similarity for the epitopes (see Similarity score of the aligned epitopes). Identifying the seed pairs. The seed residue pairs are those in the similar neighboring environments, in terms of both residue layout and physicochemical properties. A set of fingerprints was designed to describe the local environment for each residue in an epitope. Structural fingerprint generation via the "spin-image" system: The spin-image system was initially designed to represent 3D objects for efficiently solving the object recognition and reconstruction problems. The spin-image system aims to project the neighboring residue layout to a two-dimensional (2D) array by rotating the dynamic plane of each epitope residue 26 . An input epitope structure will be described by the collection of 2D images, defined as spin-images. Each epitope residue is finally recorded as a unique image of a 2D array describing the local residue layout around the target residue. In this manner, an epitope surface can be represented by a group of spin images. Each epitope residue r i is simplified as a point P i by its alpha carbon atom, Cα. Then, the geometric center C of the whole epitope is calculated by averaging the 3D coordinates of all the epitope residues. The center C is set as the origin of the coordinate system. The vector CP ! is set as the rotating axis of the dynamic plane. Along with a fixed-size rotating plane rotating around CP ! , all the surface residues in an epitope can be projected onto a certain position in the plane. This plane can be divided into a 2D grid by appropriate horizontal and vertical pixels ( Supplementary Fig. 6 ). Different plane sizes and grid resolutions were tested. An optimized plane size and grid resolution were selected (Supplementary Fig. 7 and Supplementary Note 4). Physicochemical fingerprint in the shell layers: As the physicochemical properties of hydrophobic interactions, hydrogen-bond and electrostatic interactions were reported to play essential roles in the specific binding of an antigen and antibody 27,28 , we presented a shell model to add these physicochemical properties at different layers around the target residue P. By means of the shell structure, the hydrophobicity, hydrogen bonding, and electrostatic interactions 29 of the neighboring residues were summarized in the shell layers according to the distance of the neighboring residue and the target residue P (Supplementary Fig. 8 ). After optimization, layers of shells within 20 Å of P were generated at a step size of 2 Å. Finally, seeding residue pairs could be identified between two epitope surfaces based on the residue fingerprints of the structural environment and physicochemical properties. Epitope alignment based on the "seed row" strategy. Step 1: Pearson correlation coefficients are calculated between each residue pair between epitope A and B, based on the residue fingerprints. The most similar residue pair with the highest Pearson coefficient will be taken as "seed 1". Step 2: Within a defined distance to "seed 1" (seeding distance), all the neighboring residues are compared between the two epitopes via step 1 to match additional similar pairs with similar environments. Each residue is allowed to appear in only one residue pair. Step 3: Continue comparing until all the neighboring residues of "seed 1" are screened or the Pearson correlation coefficient drops to a certain level (<0.5). Step 4: Outside the seeding distance of seed 1, repeat from step 1 to start a new round of seed identification until all the epitope residues are screened or the Pearson correlation coefficient drops below 0.5. Until this point, two epitopes were aligned by a group of residue pairs with similar local environment and physicochemical properties. For the highly different epitopes with no similar residue pairs of Pearson correlation coefficients above 0.5, the alignments will still be made according to the ranking of the Pearson correlation coefficients. Similarity score of the aligned epitopes. The similarity score is designed to cover three important measurements: the number of the matched residue pairs ðRP AB Þ, the environmental similarity ES AB ð Þ, and the evolutionarily distance as denoted by the residue-transition score ðRT AB Þ. Then, a linear model is adopted to integrate the above values into a Raw Score ðRS AB Þ, as shown by formula (1): where, RP AB indicates the number of the matched residue pairs between epitope A and B; ES AB is calculated by accumulating the Pearson correlation coefficients P k i l i of all the matched residue pairs k i ; l i ð Þderived from fingerprint comparison; and RT AB is equal to the summarized value in the BLOSUM62 matrix for the two matched residues. The α; β; γ values are designed to adjust the magnitude of the unbalanced score, and set as 1, 10, 1, respectively. Finally, the raw score of similarity ðRS AB Þ is normalized by the self-query score into a range of (0~1] to remove the size bias of different epitopes. For a query epitope of A, the final similarity score SS AB ð Þto a targeted B epitope can be calculated as shown below: where, the similarity score SS AB is the normalized score of target B against query A. Thus, the score of SS AB and SS BA may be different. Application of CE-BLAST to different pathogens. Influenza: As the mutated HA sequences of influenza are highly similar, the epitope alignment can be derived from the sequence alignment. Furthermore, the property of N-glycosylation sites are added into the shell structures of the available physicochemical properties. The numbers of potential N-glycosylation sites are counted for each layer of shell. The N-glycosylation sites are defined by sequons of Asn-X-Ser/Thr, where X represents any amino acid apart from proline 17 . For inter-pathogen cases such as influenza HA protein, the cutoff of SS AB is defined as 0.9, according to the optimal point in the ROC curve. Then, the theoretical antigenicity distance TD ab ð Þis translated and normalized as formula 3, where ϑ 0 ¼ 1; ϑ ð1Àcutoff Þ ¼ 4. Dengue virus E protein: To generate the complete data for antigenic mapping, 19 tested strains with undone (empty value) in each line were removed from Table S3 , described by Leah et al. 6 . For those with antisera values labeled as <10, we arbitrarily set a value of 5 to simplify the calculation. A total of 28 tested strains remained with antisera values for each. Then, for the each line of the tested strain, titer values were normalized within 0 to 1, by setting the highest antisera value as 1 (Supplementary Data 1) . Finally, antigenic mapping was performed by ordinal MDS according to the normalized titers. Potential cross-reactive epitope scanning between DENV and ZIKV: The E protein epitope scanning between DENV and ZIKV contains three steps. First, surface areas of the E protein were identified. Here, the trimer structure of the dengue virus (PDB: 3j27) was selected as a template. The accessible residues were defined as those amino acids on chain C with area solvent accessible surface (ASA) value over 1 Å 2 , the ASA values were calculated using Naccess 30 . Then, the surface residues were artificially selected among those accessible residues, as shown in Supplementary Fig. 9 . Secondly, all the surface patches were identified. For each residue R as center, all the surface residues within its neighborhood with certain threshold were defined as its surface patch. After scanning all the residues of E protein, different surface patches could be derived. Finally, the CE-BLAST score of each corresponding surface patch from DENV and ZIKV was calculated. The two surface patches with CE-BLAST scores above the threshold were defined as the potential CRPs. A total of 20 E protein structures including four for ZIKV and 16 for DENV (4 for each serotype) were used in this study; the corresponding strains with GenBank ID are given in Supplementary Table 7 . Experimental validation of influenza H3 can be found Supplementary Note 5. Code availability. Main algorithms were integrated into CE-BLAST web server and can be accessed at http://badd.tongji.edu.cn/ce_blast/ or http://bidd2.nus.edu. sg/czw/ce_blast/. Other code related with this manuscript is available from authors on request. Data availability. In this paper, the HI data and the corresponding strain names used in section High and robust performance on historical HI data of influenza H3 were collected from reports of international organizations and publications as Supplementary Note 2 described. Artificially consolidated dataset can be found in Supplementary Data 2, and sequences were summarized in Supplementary Data 3. The sequence data used in section Reliable prediction for a new influenza H3 vaccine were listed in Supplementary Table 1 , sequence comparison of Con H3 and reference strains can be found in Supplementary Fig. 2 . Serum data of DENV viruses used in section Correct prediction of serological topology for DENV subtypes were collected from Table S3 of Katzelnick's work 6 , and normalized serum data used in this section can be found in Supplementary Data 1. Strain ID of DENV and ZIKV used in section Successful identification of cross-reactive epitopes between DENV and ZIKV were listed in Supplementary  