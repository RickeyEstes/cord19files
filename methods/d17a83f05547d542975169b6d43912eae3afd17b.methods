Cell lines and viruses. HaCaT cells 58 were grown in Glasgow minimal essential medium supplemented with 10% FCS, 2 mM glutamine, 100 U ml À 1 penicillin and 100 g ml À 1 streptomycin. Vero cells (from ATCC) and telomerase immortalized human foreskin fibroblasts (HFF-TERT 59 ) were maintained in DMEM completed with 10% fetal bovine serum (FBS), 2 mM glutamine, 100 U ml À 1 penicillin and 100 g ml À 1 streptomycin. A bacterial artificial chromosome cloned HSV-1 genome isolate (strain KOS) was used in these studies and was described previously 60 . VP26-mTurquoise and EYFP-gM viruses were prepared using Red Recombination of bacterial artificial chromosome cloned HSV-1 genome 61 by replacing amino acids 1-4 of VP26 with mTurquoise and adding EYFP(A206K) to the C-terminus of gM. To prepare purified viruses, HaCaT cells were infected at 0.01 plaqueforming unit (PFU) per cell and incubated for 3 days. Supernatants were collected and cleared by low-speed centrifugation. The viruses obtained from the culture supernatants were pelleted at 24,000 g for 2 h and resuspended in PBS with 1% FBS. Viruses were further purified by 5-15% Ficoll gradient ultracentrifugation at 17,500 g for 1.5 h. Visible virus band was collected and spun down at 49,000 g for 2 h. Pellet was resuspended in PBS, aliquoted and stored at À 70°C. Virus titre was assessed by titration in Vero cells. Antibodies preparation and labelling. Monoclonal antibodies against VP16 (LP1; Abcam (Ab110226)), gD (LP2) and VP1/2 (CB4) were described previously 14, 62, 63 . To generate HSV-1 pUL37-specific monoclonal antibodies, female BALB/c mice were infected with HSV-1 (strain 17) by ear scarification followed by an intraperitoneal boost 1 month later. Spleens were harvested 3 days later, and B-cell hybridomas were generated as previously described 64 . Hybridoma supernatants were screened for reactivity in immunofluorescence assays by using cells transfected with an HSV-1 pUL37 expression plasmid. A cloned hybridoma line secreting antibodies with a strong reactivity to HSV-1 pUL37 was selected and named CB8. Secondary AF antibodies were purchased from Molecular Probes, anti-mouse IgG1 conjugated to ATTO 532 were from Rockland antibodies and assays. AF647 succinimidyl ester was from Molecular Probes. Monoclonal antibodies were purified from hybridoma supernatants using Protein A or G sepharose 4B fast flow from Sigma. Fab fragments were prepared using Pierce Mouse IgG1 Fab and F(ab 0 ) 2 preparation kit for LP1 (IgG1) and Pierce Fab Preparation Kit for LP2 (IgG2a), CB8 (IgG2a) and CB4 (IgG2b), following the manufacturer's instructions. Primary antibodies and Fab fragments were labelled with succinimidyl ester AF probe as follows. Probe was dissolved in dissolved in dimethylformamide to concentration 1 mg ml À 1 immediately prior reaction. Molecular ratio of probe to protein was set to 2.5. One hundred micrograms of antibody/Fab was incubated with probe in 50 mM NaHCO 3 for 1 h. Labelled antibody was purified from unbound dye directly after reaction using NAP5 Sephadex G-25 column from GE Healthcare. Average degree of labelling was between 1.0 and 1.5, as determined using instructions from Molecular Probes. Labelling viruses. Lab-Tek II chambers were first blocked with 2 M glycine and coated with poly-L-lysine. Viruses (4 Â 10 6 PFU) was bound for 1 h and then fixed with 3% EM-grade formaldehyde. Blocking and permeabilization was performed with 0.1% Triton X-100, 2% FBS in PBS and followed by antibody binding. Typically, primary antibodies were used at 100 mg ml À 1 and secondary at a dilution of 1/500. An additional post-staining fixation step using 3% EM-grad formaldehyde was included to prevent antibodies detaching from antigens. Infection assay. HFF cells were seeded onto Lab-Tek II dish after glycine blocking the plate. The next day, cells were infected with KOS VP26-mTQ/gM-EYFP virus at 5 PFU per cell. After 12-h infection, cells were fixed, permeabilized and labelled with antibodies as described above. dSTORM imaging. The imaging was performed on inverted total internal reflection fluorescence (TIRF) microscopes (Nikon TE-300 and Olympus IX-71, Japan) custom-built for dSTORM acquisition, as previously described 22, 65, 66 . The Nikon TE-300 microscope was equipped with an iXon3 897 EM-CCD camera (Andor, UK) and the Olympus IX-71 was equipped with two iXon DU897 EM-CCD cameras (Andor). The dyes were irradiated with lasers and their fluorescence collected with appropriate band-pass filters using the following laser-filter combinations: 640 nm diode laser (either iBeam Smart, Toptica, Germany, or Cube 640-100C, Coherent, USA) and 676/37 or 679/41 (Semrock, USA) for AF647, 561/568 nm laser (either 561 DPSS, Oxxius, France, or 568LP, Coherent) and 607/ 70 (Semrock) for AF568, 532 nm Nd:YAG laser (Nano 250-532-100, Linos, Germany) and 582/75 (Semrock) for ATTO532, 491 nm DPSS laser (Cobolt, Sweden) and 530/55 (Semrock) for EYFP and 405 nm diode laser with 530/55 (Semrock) for mTurquoise. For single-colour dSTORM imaging using AF647, the switching buffer was composed of 100 mM mercaptoethylamine (Sigma) in PBS solution at pH 8.2. For each field of view, a time series of up to 30,000 frames was acquired with 15 ms exposure and 1-2 kW cm À 2 irradiance. Subsequently, fluorescence emission from AF568 and mTurquoise were acquired (100 frames and 100 ms exposure). For two-colour dSTORM acquisition, between 15,000 and 30,000 frames were acquired for each channel at a frame rate of 10-100 Hz. AF647/AF568, AF647/ AF546 and AF647/ATTO532 were excited with irradiation intensities at 2-5 kW cm À 2 in switching buffer (Supplementary Note 7). The imaging of purified viruses was carried out using TIRF illumination. For cell imaging, highly inclined illumination 67 was used. Localization and super-resolution image reconstruction. All dSTORM data set were analysed using rapidSTORM 3.3 (ref. 68 ). In addition, for two-colour dSTORM imaging, the chromatic offset between the channels was corrected by using image registration (Fiji, bUnwarpJ 69 ). The chromatic transformations were obtained from white fluorescent microspheres (100 nm TetraSpeck microsphere, Invitrogen). Virus particle averaging and parameter fitting analysis. All analysis subsequent to dSTORM image reconstruction was performed using custom-written MATLAB routines (Mathworks). Briefly, the fluorescence image stacks obtained for mTurquoise and AF568 were independently averaged and converted into masks by thresholding. The masks obtained were applied to the dSTORM image. The protein labelled with AF568 was chosen such that it is located in a different structure than that labelled with AF647. When AF647 was used to label a protein present in the tegument, AF568 was used to label a protein in the envelope (glycoproteins). Inversely, if AF647 was used to label a protein from the envelope, AF568 was used to label a protein in the tegument. Virus particles present in the masked dSTORM image were then located by circular Hough transform 70 , allowing detection of circular structures and determination of the coordinates of their centre (see Supplementary Note 1). The coordinates of the centre of each particle identified by circular Hough transform were used for particle alignment. The aligned localizations were used to produce the high-density super-resolved image, using the same image reconstruction as that used by rapidSTORM. The diameter and thickness of each protein layer was obtained by weighted non-linear least-square fitting (Levenberg-Marquardt algorithm) of the radial distribution from the aligned localization coordinates to that of the MCV model. The goodness of fit was assessed by calculating the corresponding reduced w 2 parameter as shown in equation (1). Where N(r i ) is the value of the experimental histogram at the radius bin r i , N m (r i ) is the value of the histogram at the radius r i obtained from the MCV model, n is the total number of bins in the radius histogram and p is the number of fitted parameters (p ¼ 2). The two fitted parameters (the shell diameter and thickness) are determined from the optimal fit along with their 95% confidence interval. In some cases, the analysis returned a value of zero for the thickness parameter. The thickness was then considered not determinable (shown as n.d. in Fig. 3) . The analysis of the capsid spatial offset is described in details in Supplementary Note 6. The MATLAB routines for model-based and capsid spatial offset analysis used in this study are available from our website: http://wiki.laser.ceb.cam.ac.uk/wiki/ index.php/Resources. 