Data. The data, obtained from the Salvadorian Ministry of Health (MINSAL), consisted of all confirmed cases of malaria between 2010 and the first two months of 2016 (N = 91 cases, of which 30 imported, 6 P. falciparum, 85 P. vivax). All but two cases had an address listed. For these cases the location was available at the municipio, or municipality level, and the coordinates of the centroid of the municipality (which for both were cities) were used as the geo-location. Two cases had addresses listed outside of El Salvador (in Guatemala). The latitude and longitude of cases with residential addresses in El Salvador (N = 85) were found to caserío (hamlet level) using Open Street Map (https://www.openstreetmap.org/) (Supplementary Note 1). Ethical approval was not required for analysing these data as the data were not individually identifiable and could not be traced back to a single person or household. This is because the patient's residence was geo-located to hamlet level, creating a buffer and meaning we do not identify an individual's exact residential location. Data were captured through El Salvador's national epidemiological surveillance system (VIGEPES). These include cases reported by 30 public hospitals, 746 health facilities and thousands of community health workers stationed throughout the country (~3246 in 2010) 38, 45 . During this period, the number of blood slides tested per year remained similar (Supplementary Table 1 ). The line-list featured a unique patient identifier, address, age, sex, symptom onset date, and treatment seeking date, as well as details about treatment and diagnostic testing. All confirmed cases were treated. Detailed case investigation was carried out by MINSAL and cases were identified as imported or locally-acquired based on travel history, as well as primary, secondary, tertiary or orphan cases without clear sources, based on relationship with and proximity to previous cases. We obtained the latitude and longitude of the address, accurate to caserío (hamlet) level, using Open Street Map (https://www.openstreetmap.org/). El Salvador carries out reactive case detection following presentation at health facilities. However, in 2011, of 4500 slides examined through reactive case detection (representing 4.5% of all slides examined), just one additional case was detected. Both passive and active screening of migrants at key border crossings and in agricultural areas near borders also takes place. In these targeted areas, individuals are monitored for fever in the past 30 days, tested, and a single dose of chloro-primaquine prophylaxis is provided. In 2011, the Ministry of Health reported that 33,000 migrants were reached through active and passive case detection and an additional four cases of malaria were found 45 . Most cases were detected through passive surveillance in health facilities, at borders and by community health workers in rural areas. Serial interval distribution. The serial interval is defined as the time between a given case showing symptoms and the subsequent cases they infect showing symptoms 46 . For a given individual jat time t j , showing symptoms before individual i at time t i , the serial interval distribution specifies the normalised likelihood or probability density of case i infecting case j based on the time between symptom onsets, t i -t j . The serial interval summarises a number of distributions including the distribution of (a) the times between symptom onset and infectiousness onset, (b) the time for humans to transmit malaria parasites to mosquito vectors, (c) the period of mosquito infectiousness, and (d) the human incubation period. We defined a prior range of possible serial interval distributions for malaria. The serial interval distribution of treated, symptomatic P. falciparum malaria, previously characterised using empirical and model based evidence 47 was adapted to inform the prior distribution for the relationship between time and likelihood of transmission between cases in El Salvador. Two cases imported from West Africa were P. falciparum, however the remainder of cases were P. vivax. As a result the prior distribution was altered to better reflect the biology of P. vivax and the dominant vector species in El Salvador, Anopheles albimanus, but was uninformative enough to allow for possible variation in transmission dynamics, for example due to imported infections with P. falciparum. In addition, there is a possibility of a small number of asymptomatic or undetected and therefore untreated infections contributing to ongoing transmission, which will take on a longer serial interval. By defining a prior distribution for the serial interval distribution we can account for some of this uncertainty. We use a shifted Rayleigh distribution to describe the serial interval of malaria, which can be varied by changing two parameters: a and γ. The parameter a governs the overall shape of the distribution, and γ is the shifting parameter accounting for the incubation period between receiving an infectious bite and the onset of symptoms (Fig. 1a) . The γ shifting parameter was defined as ranging between 10 and 15 days to account for the minimum extrinsic incubation period within the mosquito and the minimum time between infection and suitable numbers of gametocytes in the blood to lead to symptom onset 48 . The prior for the a parameter determining the shape of the distribution was given a Uniform distribution and bounded, giving an expected time between symptom onset of one case and symptom onset of the case it infects of 29 days (95%CI = 16-300 days, sd = ±7 days), with the lower bound having an expected serial interval of 25 days (95% CI = 16 -299 days, sd = ±4 days) and the upper bound 47 days (95% CI = 16-300 days sd = ±18 days). By comparison the expected values for treated P. falciparum from existing literature range between 33 17 and 49.1 days (95%CI = 33-69) 47 . Determining the transmission likelihood. We assume cases were classified correctly from case investigation as imported or locally-acquired based on recent travel history. Following this assumption, locally acquired cases could have both infected others and been infected themselves. However imported cases could only infect others, as we assume their infection was acquired outside of the country. There were no confirmed relapse cases in the dataset, and all cases were treated with primaquine and chloroquine (radical cure) after being detected. Treatment is initiated before cases are confirmed by microscopy (see Supplementary Fig. 1 ). Active case detection is initiated locally following a confirmed case and in active foci in which local surveillance is believed to be weak. In these scenarios blood slides are examined within 24 h of being taken 49 . Given this, we assume that an individual can only be infected once by a case that has shown symptoms earlier in time. Our data input consisted of a time series of symptom (fever) onset t 2 t 1 ; ; t n f g , time ordered such that t 1 <t 2 ; ; <t n . While the times of symptom onset are known, the data do not indicate who infected whom and the underlying transmission chain, T . The goal of our model is to infer the most probable network structure, G, connecting these n infections. We can view cases as nodes in a network G, and possible transmission events as the edges linking nodes. We infer G solely from the symptom onset times t, a serial interval distribution, and prior probability distributions for the serial interval distribution parameters. G contains all possible spanning transmission chains over which an infection could spread given the observed times. G therefore includes the most likely transmission tree, but also includes, other possible trees supported by the data. We therefore can view a particular transmission tree T as a realisation of a stochastic diffusion process generated over an underlying network G. Crucially, G, accounts for competing edges and is sparse (only includes plausible edges). For a given transmission tree T describing infection events linking cases and assuming the independent cascade model 33 , the (upper triangular) likelihood of observing our times of symptom onset is simply the product of all permissible pairwise transmission likelihoods in the tree 35 . Our exposition until this point is the same as that introduced by Wallinga and Teunis 29 and extended to a wide variety of contexts by others [30] [31] [32] 43, 44, 50 . However, in contrast to previous methods based on Wallinga and Teunis we maximise the likelihood f ðtjGÞ conditional on an underlying G, a problem that is NP-hard 51 . Previous approaches have either allowed all possible connections in G 29 , sampled from the likelihood 52 or explored a limited number of pathways 53 . Here, by following the approach introduced by Rodriguez and Schölkopf 35 , we find the most likely underlying transmission network given the timing of symptom onset for a set of k transmission events linking cases. The computational hardness of maximising f ðtjGÞ meant that an optimal solution could only be found by exploring every possible transmission tree on G. However, due to the submodularity of the independent cascade model 33 a near optimal solution could be found using a greedy algorithm. Briefly, the greedy algorithm used starts with an empty graph, and then add edges sequentially such that the marginal gain in the likelihood of the transmission tree for each iteration is maximised. The marginal gain measures of importance for each edge of the network through the gain that each edge provides to the total solution over competing edges, and therefore applies shrinkage to the raw pairwise likelihood with the likelihood of competing edges. We stop when we have reached k edges (see Supplementary Fig. 2 ). Stopping at k edges ensures that the resulting network is sparse which not only ensures a parsimony but removes unnecessary edges that could influence R c calculations. An appropriate value of k is defined by adding edges until the marginal gain in likelihood of adding additional edges is below a given threshold (0.0005). We carried out a sensitivity analysis and find our results are robust to changes in this threshold between 0.001 and 1e−10 (Supplementary Note 2, Supplementary Fig. 3) . Accounting for missing cases. Assuming all cases reaching community health workers or health facilities are recorded, missing cases may be generated by two processes. Symptomatic cases may be missed by not seeking care or being found through active case detection, and or cases may be asymptomatic and therefore unlikely to seek care or be detected. The latter may have densities of parasites in their blood which are too low to be detectable by microscopy if active case detection occurs. These processes apply to both imported cases or locally acquired cases. We assume the pool of asymptomatic cases in the country is low and has a small contribution to ongoing transmission. To estimate the proportion of cases which may be going undetected within our independent cascade framework, we consider outside sources of infection, π that represent unobserved individuals who can infect any observed individual, i, in a transmission chain. Every observed individual i can get infected by unobserved individuals, π, with an arbitrarily small probability ε. This so called ϵ-edge is connected to every node in our network and do not, by design, participate in the diffusion propagation. The ϵ-edges prevents breaks in the network diffusion cascade where the likelihood of transmission between observed cases is sufficiently low, and instead the case is linked to an external source. The specific value of ε was set at 0.0005, aiming to find a balance between false positives and false negatives when linking cases by infection events. The higher the value of ε, the larger the number of nodes that are assumed to be infected by an external source. Estimating R c . We can establish individual reproduction numbers for each case by creating a matrix, R, where each column represents a potential infector and the rows represent a potential infectee, describing which infector edges are connected to infectees and the normalised marginal gain of that edge. Intuitively then, by taking the row sums of R we get the (fractional) number of secondary infections and therefore a point estimate of the time varying reproduction number R c ðt j Þ This reflects for an individual, how many people they are likely to have gone onto infect. When multiple individuals have been infected at a given time and/or place, we can take the mean individual R c and uncertainty in this value as an indicator of reproduction numbers for a given time and/or location. In contrast of traditional methods based on Wallinga and Teunis 29 using the marginal gain in this way encapsulates not only the pairwise likelihood of transmission between two cases, but conditions this likelihood on the impact of competing edges in the inferred network. Given the provable near optimal solution of the greedy algorithm and the use of marginal gains in calculating R c , our estimates of R c provide more rigorous estimates of reproduction numbers than just using standard Wallinga and Teunis 29 approaches, which do not consider the overall transmission tree in optimisation and do not account for missing cases (see Supplementary Note 3 for full derivation of methods). Estimating timelines towards elimination. To explore trends in R c over time, we fitted a generalised additive model (GAM) to the estimated R c t ð Þ values and extended this line beyond the period of observation to 2030. We then also fitted Gamma, Power law and Exponential distributions to the estimated R c (t) values, and found they were best represented by Gamma distribution according to AIC scores. To explore the likelihood of elimination by a given time point, we randomly drew 10,000 R c values from Gamma distributions with increasingly small mean reproduction numbers, keeping the fitted shape parameter constant. We then found the threshold mean R c below which the probability of an individual R c exceeding one is <5%. By extending the current fitted trendline for R c values to 2030, we identified the expected timepoint for R c to reach this threshold value, given the observed decline in R c observed over the study period. Mapping R c . To map estimates of transmission risk, individual reproduction numbers were divided into those above and below one. The latitude and longitude of the reproduction numbers were included in a geospatial hurdle model implemented in rINLA 54 where demographic and environmental covariates were used to estimate the likelihood of a case having a reproduction number above 1 if imported into the area in 2010 (Supplementary Note 4, Supplementary Table 2) ). This is a measure of malaria 'receptivity' or underlying transmission potential rather than overall malaria risk, as importation likelihood is not quantified in this analysis. AUC scores from leave one out cross validation were used to assess model fit ( Supplementary Fig. 4) . 