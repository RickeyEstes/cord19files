Dengue virus (DENV) represents a public health and economic burden in affected countries. The availability of genomic data is key to understand viral evolution and dynamics, supporting improved control strategies. Currently, the use of High Throughput Sequencing (HTS) technologies, which can be applied both directly to patient samples (shotgun metagenomics) and to PCR amplified viral sequences (targeted metagenomics), is the most informative approach to monitor the viral dissemination and genetic diversity. Despite many advantages, these technologies require bioinformatics expertise and appropriate infrastructure for the analysis and interpretation of the resulting data. In addition, the many software solutions available can hamper reproducibility and comparison of results. Here we present DEN-IM, a one-stop, user-friendly, containerised and reproducible workflow for the analysis of DENV sequencing data, both from shotgun and targeted metagenomics approaches. It is able to infer DENV coding sequence (CDS), identify serotype and genotype, and generate a phylogenetic tree. It can easily be run on any UNIX-like system, from local machines to high-performance computing clusters, performing a comprehensive analysis without the requirement of extensive bioinformatics expertise. Using DEN-IM, we successfully analysed two DENV datasets. The first comprised 25 shotgun metagenomic sequencing samples of varying serotype and genotype, including a spiked sample containing the existing four serotypes. The second dataset consisted of 106 targeted metagenomics samples of DENV 3 genotype III where DEN-IM allowed detection of the intra-genotype diversity. The DEN-IM workflow, parameters and execution configuration files, and documentation are freely available at https://github.com/B-UMMI/DEN-IM. The Dengue virus (DENV), a single-stranded positive-sense RNA virus belonging to the Flavivirus 2 genus, is one of the most prevalent arboviruses and is mainly concentrated in tropical and subtropical 3 regions. Infection with DENV results in symptoms ranging from mild fever to haemorrhagic fever and 4 shock syndrome [1]. Transmission to humans occurs through the bite of Aedes mosquitoes namely 5 Aedes aegypti and Aedes albopictus [2] In 2010, it was predicted that the burden of dengue disease 6 reached 390 million cases per year worldwide [3]. The high morbidity and mortality of dengue makes 7 it the arbovirus with the highest clinical significance [4]. 8 The viral genome of ∼11,000 nucleotides, consists of a Coding Sequence (CDS) of approximately 9 10.2 Kb that is translated into a single polyprotein encoding three structural proteins (capsid -C, 10 premembrane -prM, envelope -E) and seven non-structural proteins (NS1, NS2A, NS2B, NS3, NS4A, 11 NS4B and NS5. Additionally, the genome contains two Non-Coding Regions (NCRs) at their 5' and 12 3' ends [5]. DENV can be classified into four serotypes (1, 2, 3 and 4), differing from each other by 25% to 14 40% at the amino acid level. They are further classified into genotypes that vary by up to ∼3% 15 at the amino acid level [2]. The DENV-1 serotype comprises five genotypes (I-V), DENV-2 groups 16 six (I-VI, also named American, Cosmopolitan, Asian-American, Asian II, Asian I and Sylvatic), 17 DENV-3 four (I-III and V), and DENV-4 also four (I-IV). 18 DENV is a significant public health challenge in countries where the infection is endemic due 19 to the high health and economic burden. Despite the emergence of novel therapies and ecological 20 strategies to control the mosquito vector, there are still important knowledge gaps in the virus biology 21 and its epidemiology [2]. The implementation of a surveillance system relying on High Throughput Sequencing (HTS) 23 technologies allows the simultaneous identification and surveillance of DENV cases. Due to the 24 high sensitivity of these technologies, previous studies showed that viral sequences can be directly 25 obtained from patient sera using a shotgun metagenomics approach [6]. Alternatively, HTS can be 26 used in a targeted metagenomics approach in which a PCR step is used to pre-amplify viral sequences 27 before sequencing. In recent years, HTS has been successfully used as a tool for identification of 28 DENV directly from clinical samples [6, 7]. This also allows the rapid identification of the serotype 29 and genotype important for disease management as the genotype may be associated with disease 30 outcome [8]. 31 Several initiatives aim to facilitate the identification of the DENV serotype and genotype from 32 HTS data. The Genome Detective project (https://www.genomedetective.com/) offers an online 33 Dengue Typing Tool (https://www.genomedetective.com/app/typingtool/dengue/) relying on 34 BLAST and phylogenetic methods in order to identify the closest serotype and genotype, but it 35 requires as input assembled genomes in FASTA format. Alternatively, the same project offers 36 a Genome Detective Typing Tool (https://www.genomedetective.com/app/typingtool/virus/) 37 identifying viruses present in a sample. We developed DEN-IM as a ready-to-use, one-stop, reproducible bioinformatic analysis workflow 39 for the processing and phylogenetic analysis of DENV using paired-end raw HTS data. DEN-IM is 40 implemented in Nextflow [9], a workflow manager software that uses Docker (https://www.docker. 41 com) containers with pre-installed software for all the workflow tools. The DEN-IM workflow, as well 42 as parameters and documentation, are available at https://github.com/B-UMMI/DEN-IM. 43 3 The DEN-IM Workflow 44 DEN-IM is a user-friendly automated workflow allowing the analysis of shotgun or targeted metage-45 nomics data for the identification, serotyping, genotyping, and phylogenetic analysis of DENV. It is 46 implemented in Nextflow, a workflow management system that allows the effortless deployment and 47 3 . CC-BY 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/628073 doi: bioRxiv preprint execution of complex distributed computational workflows. The workflow is composed of five blocks: 1. Quality Control and Trimming, 2. Retrieval of DENV 49 sequences, 3. Assembly, 4. in silico Typing, and 5. Phylogeny, described in more detail in Figure 1 . 50 DEN-IM accepts as input raw paired-end sequencing data (FASTQ files), and informs the user with 51 an interactive HTML report with information on the quality control, mapping, assembly typing and 52 phylogenetic analysis, as well as all the output files of the whole pipeline. 53 3.1 1. Quality Control and Trimming 54 The Quality Control (QC) and Trimming block starts with a process to verify the integrity of the 55 input data. If the sequencing files are corrupted, the execution of the analysis of that sample is 56 terminated. 57 The sequences are then processed by FastQC (https://www.bioinformatics.babraham.ac.uk/ 58 projects/fastqc/, version 0.11.7) to determine the quality of the individual base pairs of the 59 raw data files. The low quality bases and adapter sequences are trimmed by Trimmomatic [10] 60 (version 0.36). By default, Trimmomatic removes the Illumina Nextera, TruSeq2 and TruSeq3 adapter 61 sequences that are detected, and relies on Phred scores [11] and FastQC analysis data to determine 62 to which extend the 5' and 3' ends of the reads need to be trimmed. The crop and headcrop setting 63 is calculated per sample, based on the GC ratio of each half of the read. By default, the window size 64 is set to 5 nucleotides with a minimum average quality of 20. In addition, paired-end reads with a 65 read length shorter than 55 nucleotides after trimming are removed from further analyses. 66 Lastly, the low complexity sequences, containing over 50% of poly-A, poly-N or poly-T nucleotides, 67 are filtered out of the raw data using PrinSeq [12] (version 0.10.4). 68 3.2 2. Retrieval of DENV Sequences 69 In the second step, DENV sequences are selected from the sample using Bowtie2 [13] (version 70 2.2.9) and Samtools [14] (version 1.4.1). As a reference we provide the DENV mapping database, a 71 curated DENV database composed of 3830 complete DENV genomes (see Methods, DENV Reference 72 Database). A permissive approach is followed by allowing for mates to be kept in the sample even 73 when only one read maps to the database in order to keep as many DENV derived reads as possible. The output of this step is a set of processed reads of putative DENV origin. 75 3.3 3. Assembly 76 DEN-IM applies a two assembler approach to generate assemblies of the DENV CDS. To obtain a 77 high confidence assembly, the processed reads are first de novo assembled with SPAdes [15] (version 78 3.12.0). If the full CDS fails to be assembled into a single contig, the data is re-assembled with 79 MEGAHIT assembler [16] (version 1.1.3), a more permissive assembler developed to retrieve longer 80 sequences from metagenomics data. The resulting assemblies are corrected with Pilon [17] (version 81 1.22) after mapping the processed reads to the assemblies with Bowtie2 [13]. 82 If more than one complete CDS is present in a sample, each of the sequences will follow the rest 83 of the DEN-IM workflow independently. If no full CDS is assembled neither with SPAdes nor with 84 MEGAHIT, the processed reads are passed on to the next step for consensus generation by mapping, 85 effectively constituting DEN-IM's two pronged approach using both assemblers and mapping. 86 3.4 4. Typing 87 For each DENV complete CDS, the serotype and genotype is determined with the Seq Typing tool 88 (https://github.com/B-UMMI/seq_typing, version 2.0) [18] using BLAST [19] and the custom 89 Typing database of DENV containing 161 complete sequences (see Methods, DENV Reference 90 Database). The BLAST results are first cleaned to get the best hit for each sequence in the database, 91 based on alignment length, similarity, e-value and number of gaps. The tool determines which 92 reference sequence is more closely related to the query based on the identity and length of the 93 sequence covered, returning the serotype and genotype of the reference sequence for the purpose of 94 classifying the query. If a complete CDS fails to be obtained through the assembly process, the processed reads are 96 mapped against the DENV typing database, with Bowtie2 [13], using Seq Typing tool, with similar 97 criteria for coverage and identity to those used with the BLAST approach. If a type is determined, 98 the consensus sequence obtained follows through to the next step in the workflow. Otherwise, the 99 sample is classified as Non-Typable and its process terminated. 100 3.5 5. Phylogeny 101 All DENV complete CDSs and consensus sequences analysed in a workflow execution are aligned 102 with MAFFT [20] (version 7.402), in auto mode and with orientation being automatically determined 103 and adjusted. With the resulting alignment, a Maximum Likelihood tree is inferred with RaXML [21] 104 (version 8.2.11), using as default the GTR-Γ substitution model and a 500 times bootstrap. 105 Optionally, the closest reference sequence in the DENV typing database to each analysed sample 106 can be retrieved and included in the phylogenetic analysis. 107 4 Workflow Execution 108 The DEN-IM workflow can be executed in any UNIX-based system, from local machines to high-109 performance computing clusters (HPC) facilities with Nextflow and a container engine installation, 110 such as Docker (https://www.docker.com/, Shifter [22] or Singularity [23]. 111 Due to its Nextflow implementation, DEN-IM allows for out-of-the-box high-level parallelization 112 and offers direct support for distributed computational environments. DEN-IM integrates Docker 113 containerised images for all the tools necessary for its execution, ensuring reproducibility and the 114 tracking of both software code and version, regardless of the operating system used. The Docker 115 images provided are also compatible with other container engines. 116 Users can customise the workflow execution either by using command line options or by modifying 117 a simple plain-text configuration file (params.config). The version of each of the tools used in 118 DEN-IM can be changed by providing new container tags in the appropriate configuration file 119 (containers.config). The resources for each process can also be changed (resources.config). To make 120 the execution of the workflow as simple as possible, a set of default parameters and directives is 121 provided. 122 The local installation of the DEN-IM workflow, including the docker containers with all the tools 123 needed and the curated DENV database, requires 15 Gigabytes of free disk space. The minimum 124 requirements to execute the workflow are at least 5 Gigabytes of memory and 4 CPUs, although 7 125 Gigabytes of memory is advised. The disk space required for execution depends greatly on the size 126 of the input data, but for the datasets used in this article DEN-IM generates approximately 20 Gb 127 data per Gb of input data. 128 5 Output and Report 129 The output files of all tools are stored in the 'results' folder in the directory of the DEN-IM execution. 130 The execution log file for each component, as well as a log file for the execution of the workflow, are 131 also available. 132 DEN-IM creates an interactive HTML report (Figure S1), stored in the 'pipeline results' directory, 133 containing all the information in the results divided into four sections: report overview, tables, charts 134 and phylogenetic tree. The report can be easily exchanged between collaborators by compressing 135 and sharing the "pipeline report" folder. 136 The report overview contains information about the number of samples in the analysis. It allows 137 for selection, filtering and highlighting of particular samples and tools in the workflow. 138 The table section contains the results and statistics the quality control, assembly, read mapping 139 and in silico typing results. The in silico typing table contains the results of the serotype and 140 genotype of each CDS analysed, as well as identity and coverage and GenBank ID for the closest 141 reference in the DENV typing database. doi: bioRxiv preprint 206 was generated. For the assembled CDSs, all but one were assembled with MEGAHIT after not 207 producing a full CDS with SPAdes. Moreover, pronounced variation on the size of the assembled 208 8 . CC-BY 4.0 doi: bioRxiv preprint As a positive control sample, the supernatant of a viral culture containing DENV-2 strain 16681 388 was used. The negative control sample consisted of DNA-and RNA-free water (Sigma-Aldrich, St. 389 Louis, MO, USA). 390 A spiked sample was produced consisting of a mixture of four 5 µl of cDNA isolated from clinical 391 samples including all DENV serotypes (DENV-1 to -4). The viral cDNA for these samples was not in 392 equal concentration and the viral copy number in the clinical samples was assessed by RT-PCR [35]. 393 The results were as follow: DENV-2 with 1070000 copies/µl, DENV-1 with 117830 copies/µl, DENV-3 394 with 44300 copies/µl and DENV-4 with 6600 copies/µl. The cDNA libraries were generated using either the NEBNext R RNA First and Second strand 396 modules and the Nextera XT DNA library preparation kit (NXT), or the TruSeq RNA V2 library 397 preparation kit (TS). The libraries were sequenced in MiSeq and NextSeq instruments using 300-cycles 398 13 . CC-BY 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/628073 doi: bioRxiv preprint v2 paired-end cartridges. The DEN-IM workflow was executed with the raw sequencing data using the default parameters 400 and resources in an HPC cluster with 300 Cores/600 Threads of Processing Power and 3 TB RAM 401 divided through 15 computational nodes, 9 with 254 GB Ram and 6 with 126GB RAM. 402 9.4 Targeted Metagenomics Sequencing Data 403 The accession numbers for the 106 DENV-3 amplicon sequencing paired-end short-read datasets 404 are available under BioProject PRJNA394021. The list of Run Accession IDs were obtained 405 with NCBI's RunSelector and the raw data was downloaded with the GetSeqENA tool (https: 406 //github.com/B-UMMI/getSeqENA). The DEN-IM workflow was executed with the raw sequencing data with default parameters and 408 resources in the same HPC cluster as the shotgun metagenomics dataset. 409 10 Availability of source code and requirements 410 Lists the following: 411 • Project name: DEN-IM 412 • Project home page: https://github.com/B-UMMI/DEN-IM 413 • Operating system(s): UNIX-like systems. 414 • Programming language: Nextflow, Python, Bash 415 • Other requirements: Java version 8 or highest. Docker/Singularity/Shifter 416 • License: GNU GPL v3 417 • Documentation and tutorials: https://github.com/B-UMMI/DEN-IM/wiki 418 11 Availability of supporting data and materials 419 The 106 DENV-3 targeted metagenomics sequencing paired-end short-read datasets are available 420 under BioProject PRJNA394021. The 25 shotgun metagenomics dataset is available under Bioproject 421 PRJNA474413 The accession number for all the samples in the shotgun metagenomics dataset are 422 available in the supplemental material (Table S3) . 423 12 Declarations 424 12.1 List of abbreviations 425 Control 428 12.2 Ethical Approval (optional) 429 This study followed international standards for the ethical conduct of research involving human 430 subjects. Data and sample collection was carried out within the DENVEN and IDAMS (International 431 Research Consortium on Dengue Risk Assessment, Management and Surveillance) projects. The 432 study was approved by the Ethics Review Committee of the Biomedical Research Institute, Carabobo 433 University (Aval Bioetico #CBIIB(UC)-014 and CBIIB-(UC)-2013-1), Maracay, Venezuela; the 